/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@loaders.gl/wms@4.2.0/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{XMLLoader as e,convertXMLFieldToArrayInPlace as t}from"../xml@4.2.0/_esm.js";import r from"../../@turf/rewind@5.1.5/_esm.js";import{ImageSource as s,mergeLoaderOptions as n,DataSource as o}from"../loader-utils@4.2.0/_esm.js";export{ImageSource}from"../loader-utils@4.2.0/_esm.js";import{ImageLoader as a}from"../images@4.2.0/_esm.js";function i(e){const t=e.exceptionReport;if(!t)return;const r=t.exception?.exceptionText||t.exception?.exceptionCode||t.exception?.locator||"server error";throw new Error(`Catalog Server: ${r}`)}function c(t,r){const s=e.parseTextSync?.(t,{...r,xml:{...r?.xml,removeNSPrefix:!0,uncapitalizeKeys:!0}});i(s);return s.capabilities||s}const l={dataType:null,batchType:null,id:"csw-capabilities",name:"CSW Capabilities",module:"wms",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.csw_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{csw:{}},parse:async(e,t)=>c((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>c(e,t)};function u(t,r){const s=e.parseTextSync?.(t,{...r,xml:{...r?.xml,removeNSPrefix:!0,uncapitalizeKeys:!0,arrayPaths:["GetDomainResponse.DomainValues","GetDomainResponse.DomainValues.ListOfValues.value"]}});i(s);const n=s.getDomainResponse;for(const e of n.domainValues)e.values=e.listOfValues?.value,delete e.listOfValues;return n}const p={dataType:null,batchType:null,id:"csw-domain",name:"CSW Domain",module:"wms",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.csw_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{csw:{}},parse:async(e,t)=>u((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>u(e,t)};function m(r,s){const n=e.parseTextSync?.(r,{...s,xml:{...s?.xml,removeNSPrefix:!0,uncapitalizeKeys:!0,arrayPaths:[],_fastXML:{...s?.xml?._fastXML,parseAttributeValue:!0}}});i(n);const o=n.getRecordsResponse,a=`${o.searchResults.elementSet}Record`;o.records=o.searchResults[a],delete o.searchResults[a],t(o,"records");for(const e of o.records){e.boundingBoxes=e.boundingBox,delete e.boundingBox,t(e,"boundingBoxes");for(const t of e.boundingBoxes)t.value=[t.upperCorner[0],t.upperCorner[1],t.lowerCorner[0],t.lowerCorner[1]],delete t.upperCorner,delete t.lowerCorner}return o}const f={dataType:null,batchType:null,id:"csw-records",name:"CSW Records",module:"wms",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.csw_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{csw:{}},parse:async(e,t)=>m((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>m(e,t)};const h={dataType:null,batchType:null,id:"wms-error",name:"WMS Error",module:"wms",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.se_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{wms:{throwOnError:!1}},parse:async(e,t)=>d((new TextDecoder).decode(e),t),parseSync:(e,t)=>d((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>d(e,t)};function d(t,r){const s={...h.options.wms,...r?.wms},n=function(t,r){const s=e.parseTextSync?.(t,r),n=s?.ServiceExceptionReport?.ServiceException||s?.["ogc:ServiceExceptionReport"]?.["ogc:ServiceException"];return"string"==typeof n?n:n.value||n.code||"Unknown error"}(t,s),o=s.minimalErrors?n:`WMS Service error: ${n}`;if(s.throwOnError)throw new Error(o);return o}function g(e){return Array.isArray(e)?e:e?[e]:[]}function y(e){const t=g(e);return t.length>0&&t.every((e=>"string"==typeof e))?t:[]}function w(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseFloat(e);default:return}}function x(e,t=void 0){switch(typeof e){case"number":return e;case"string":return parseInt(e,10);default:return}}function b(e){switch(e){case"true":case"1":return!0;default:return!1}}function S(t,r){const s=e.parseTextSync?.(t,r),n=s.WMT_MS_Capabilities||s.WMS_Capabilities||s,o=function(e){const t={version:String(e.version||""),name:String(e.Service?.Name||"unnamed"),title:e.Service?.Title?String(e.Service?.Title):void 0,abstract:e.Service?.Abstract?String(e.Service?.Abstract):void 0,keywords:y(e.Service?.KeywordList?.Keyword),fees:e.Service?.Fees?JSON.stringify(e.Service?.Fees):void 0,accessConstraints:e.Service?.AccessConstraints?JSON.stringify(e.Service?.AccessConstraints):void 0,layerLimit:x(e.Service?.LayerLimit),maxWidth:x(e.Service?.maxWidth),maxHeight:x(e.Service?.maxHeight),layers:[],requests:v(e.Capability?.Request),exceptions:R(e.Exception)},r=g(e.Capability?.Layer);for(const e of r)t.layers.push(L(e));for(const[e,r]of Object.entries(t))void 0===r&&delete t[e];return t}(n);if(r?.inheritedLayerProps)for(const e of o.layers)C(e,null);return r?.includeRawJSON&&(o.json=n),r?.includeXMLText&&(o.xml=t),o}function v(e){const t={};for(const[r,s]of Object.entries(e||{})){const e=y(s?.Format);t[r]={mimeTypes:e}}return t}function R(e){if(g(e?.Format).length>0)return{mimeTypes:y(e)}}function L(e){const t={title:String(e?.Title||""),name:e?.Name&&String(e?.Name),abstract:e?.Name&&String(e?.Abstract),keywords:y(e.KeywordList?.Keyword)},r=e?.CRS||e?.SRS;r&&Array.isArray(r)&&r.every((e=>"string"==typeof e))&&(t.crs=r);let s=e?.EX_GeographicBoundingBox&&function(e){const{westBoundLongitude:t,northBoundLatitude:r,eastBoundLongitude:s,southBoundLatitude:n}=e;return[[t,n],[s,r]]}(e?.EX_GeographicBoundingBox);s&&(t.geographicBoundingBox=s),s=e?.LatLonBoundingBox&&function(e){const{minx:t,miny:r,maxx:s,maxy:n}=e;return[[t,r],[s,n]]}(e?.LatLonBoundingBox),s&&(t.geographicBoundingBox=s);const n=e?.BoundingBox&&(o=e?.BoundingBox,g(o).map((e=>function(e){const{CRS:t,SRS:r,minx:s,miny:n,maxx:o,maxy:a,resx:i,resy:c}=e,l={crs:t||r,boundingBox:[[w(s),w(n)],[w(o),w(a)]]};return i&&(l.xResolution=i),c&&(l.yResolution=c),l}(e))));var o;n&&n.length>0&&(t.boundingBoxes=n);const a=g(e?.Dimension).map((e=>function(e){const{name:t,units:r,value:s}=e,n={name:t,units:r,extent:s};e.unitSymbol&&(n.unitSymbol=e.unitSymbol);e.default&&(n.defaultValue=e.default);e.multipleValues&&(n.multipleValues=b(e.multipleValues));e.nearestValue&&(n.nearestValue=b(e.nearestValue));e.current&&(n.current=b(e.current));return n}(e)));a.length&&(t.dimensions=a),e?.opaque&&(t.opaque=b(e?.opaque)),e?.cascaded&&(t.cascaded=b(e?.cascaded)),e?.queryable&&(t.queryable=b(e?.queryable));const i=g(e?.Layer),c=[];for(const e of i)c.push(L(e));c.length>0&&(t.layers=c);for(const[e,r]of Object.entries(t))void 0===r&&delete t[e];return t}function C(e,t){t?.geographicBoundingBox&&!e.geographicBoundingBox&&(e.geographicBoundingBox=[...t.geographicBoundingBox]),t?.crs&&!e.crs&&(e.crs=[...t.crs]),t?.boundingBoxes&&!e.boundingBoxes&&(e.boundingBoxes=[...t.boundingBoxes]),t?.dimensions&&!e.dimensions&&(e.dimensions=[...t.dimensions]);for(const t of e.layers||[])C(t,e)}const T={dataType:null,batchType:null,id:"wms-capabilities",name:"WMS Capabilities",module:"wms",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wms_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{wms:{}},parse:async(e,t)=>S((new TextDecoder).decode(e),t?.wms),parseTextSync:(e,t)=>S(e,t?.wms)};function _(t,r){const s=e.parseTextSync?.(t,r),n=s.FeatureInfoResponse?.FIELDS||[];return{features:(Array.isArray(n)?n:[n]).map((e=>function(e){const t=e||{};return{attributes:t,type:"",bounds:{bottom:0,top:0,left:0,right:0}}}(e)))}}const B={...T,dataType:null,id:"wms-feature-info",name:"WMS FeatureInfo",parse:async(e,t)=>_((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>_(e,t)};function P(t,r){const s=e.parseTextSync?.(t,r);return s}const U={...T,dataType:null,id:"wms-layer-description",name:"WMS DescribeLayer",parse:async(e,t)=>P((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>P(e,t)};function E(t,r){const s=e.parseTextSync?.(t,{...r,xml:{...r?.xml,removeNSPrefix:!0,uncapitalizeKeys:!0}});return s.Capabilities||s}const O={dataType:null,batchType:null,id:"wfs-capabilities",name:"WFS Capabilities",module:"wms",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.wfs_xml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{wfs:{}},parse:async(e,t)=>E((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>E(e,t)};function M(e,t,r){return e===t||(e instanceof Date&&t instanceof Date?e.getTime()===t.getTime():e instanceof RegExp&&t instanceof RegExp?e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase:null!==e&&"object"==typeof e||null!==t&&"object"==typeof t?function(e,t,r){if(null==e||null==t)return!1;if(k(e)||k(t))return e===t;if(r&&Object.getPrototypeOf(e)!==Object.getPrototypeOf(t))return!1;const s=W(e),n=W(t);if(s&&!n||!s&&n)return!1;if(s)return M(e=$.call(e),t=$.call(t),r);const o=Object.keys(e),a=Object.keys(t);let i,c;if(o.length!==a.length)return!1;for(o.sort(),a.sort(),c=o.length-1;c>=0;c--)if(o[c]!==a[c])return!1;for(c=o.length-1;c>=0;c--)if(i=o[c],!M(e[i],t[i],r))return!1;return!0}(e,t,r):r?e===t:e==t)}const $=Array.prototype.slice;function k(e){return null===e||"object"!=typeof e&&"function"!=typeof e}function W(e){return"[object Arguments]"==Object.prototype.toString.call(e)}function j(...e){return e}function D(t,s){const n=e.parseTextSync?.(t,s);return function(e,t,s){const n=Y(e,t,s);let o=null;const[a,i]=Q(e);switch(a){case"gml:LineString":o={type:"LineString",coordinates:F(i,t,n)};break;case"gml:Polygon":case"gml:Rectangle":o={type:"Polygon",coordinates:V(i,t,n)};break;case"gml:Surface":o={type:"MultiPolygon",coordinates:z(i,t,n)};break;case"gml:MultiSurface":o={type:"MultiPolygon",coordinates:K(i,t,n)};break;default:return null}return r(o,{mutate:!0})}(n,s={transformCoords:j,stride:2,...s},Y(n,s,{}))}function G(e,t,r){const s=r.srsDimension||t.stride||2,n=e.replace(/\s+/g," ").trim().split(" ");if(0===n.length||n.length%s!=0)throw new Error(`invalid coordinates list (stride ${s})`);const o=[];for(let e=0;e<n.length-1;e+=s){const r=n.slice(e,e+s).map(parseFloat);o.push(t.transformCoords?.(...r)||r)}return o}function I(e,t,r){const s=Y(e,t,r),n=J(e);if(!n)throw new Error("invalid gml:pos element");const o=G(n,t,s);if(1!==o.length)throw new Error("gml:pos must have 1 point");return o[0]}function A(e,t,r){const s=Y(e,t,r),n=H(e,"gml:pos");if(!n)throw new Error("invalid gml:Point element, expected a gml:pos subelement");return I(n,t,s)}function F(e,t,r){const s=Y(e,t,r);let n=[];const o=H(e,"gml:posList");if(o)n=function(e,t,r){const s=Y(e,t,r),n=J(e);if(!n)throw new Error("invalid gml:posList element");return G(n,t,s)}(o,t,s);else for(const[r,o]of Object.entries(e))switch(r){case"gml:Point":n.push(A(o,t,s));break;case"gml:pos":n.push(I(o,t,s));break;default:continue}if(0===n.length)throw new Error(`${e.name} must have > 0 points`);return n}function q(e,t,r){const s=[];for(const[n,o]of Object.entries(e))if("gml:LineStringSegment"===n){const e=F(o,t,r),n=s[s.length-1],a=e[0];n&&a&&M(n,a)&&e.shift(),s.push(...e)}if(0===s.length)throw new Error("gml:Curve > gml:segments must have > 0 points");return s}function N(e,t,r){const s=H(e,"gml:LinearRing");if(s)return F(s,t,r);const n=H(e,"gml:Ring");if(!n)throw new Error(`invalid ${e.name} element`);return function(e,t,r){const s=Y(e,t,r),n=[];for(const[r,o]of Object.entries(e))if("gml:curveMember"===r){let e;const a=H(o,"gml:LineString");if(a)e=F(a,t,s);else{const n=H(o,"gml:Curve","gml:segments");if(!n)throw new Error(`invalid ${r} element`);e=q(n,t,s)}const i=n[n.length-1],c=e[0];i&&c&&M(i,c)&&e.shift(),n.push(...e)}if(n.length<4)throw new Error(`${e.name} must have >= 4 points`);return n}(n,t,r)}function V(e,t,r){const s=Y(e,t,r),n=H(e,"gml:exterior");if(!n)throw new Error(`invalid ${e.name} element`);const o=[N(n,t,s)];for(const[r,n]of Object.entries(e))if("gml:interior"===r)o.push(N(n,t,s));return o}function z(e,t,r){const s=Y(e,t,r);if(!H(e,"gml:patches"))throw new Error(`invalid ${e.name} element`);const n=[];for(const[r,o]of Object.entries(e))switch(r){case"gml:PolygonPatch":case"gml:Rectangle":n.push(V(o,t,s));break;default:continue}if(0===n.length)throw new Error(`${e.name} must have > 0 polygons`);return n}function K(e,t,r){let s=e;const n=H(e,"gml:LinearRing");n&&(s=n);const o=[];for(const[e,n]of Object.entries(s))switch(e){case"gml:Surface":const e=z(n,t,r);o.push(...e);break;case"gml:surfaceMember":const s=X(n,t,r);o.push(...s);break;case"gml:surfaceMembers":const a=H(n,"gml:Polygon");for(const e of a){const s=X(e,t,r);o.push(...s)}}if(0===o.length)throw new Error(`${e.name} must have > 0 polygons`);return o}function X(e,t,r){const[s,n]=Q(e);switch(s){case"gml:CompositeSurface":return function(e,t,r){const s=Y(e,t,r),n=[];for(const[r,o]of Object.entries(e))switch(r){case"gml:surfaceMember":case"gml:surfaceMembers":const[e,r]=Q(o);switch(e){case"gml:Surface":n.push(...z(r,t,s));break;case"gml:Polygon":n.push(V(r,t,s))}}if(0===n.length)throw new Error(`${e.name} must have > 0 polygons`);return n}(n,t,r);case"gml:Surface":return z(n,t,r);case"gml:Polygon":return[V(n,t,r)]}throw new Error(`${s} must have polygons`)}function J(e){if("string"!=typeof e)throw new Error("expected string");return e}function H(e,...t){let r=e;for(const e of t){const t=r[e];if(!t)return null;r=t}return r}function Q(e){if(e&&"object"==typeof e)for(const[t,r]of Object.entries(e))return[t,r];return["",null]}function Y(e,t,r){const s=e.attributes&&e.attributes.srsDimension;if(s){const e=parseInt(s);if(Number.isNaN(e)||e<=0)throw new Error(`invalid srsDimension attribute value "${s}", expected a positive integer`);const t=Object.create(r);return t.srsDimension=e,t}return r}const Z={dataType:null,batchType:null,name:"GML",id:"gml",module:"wms",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/vnd.ogc.gml","application/xml","text/xml"],testText:function(e){return e.startsWith("<?xml")},options:{gml:{}},parse:async(e,t)=>D((new TextDecoder).decode(e),t),parseTextSync:(e,t)=>D(e,t)};function ee(e,t){const{type:r="auto"}=e,s="auto"===r?function(e,t){for(const r of t)if(r.testURL&&r.testURL(e))return r;return null}(e.url,t):function(e,t){for(const r of t)if(r.type===e)return r;return null}(r,t);if(!s)throw new Error("Not a valid image source type");return s.create(e)}const te={type:"wms",testURL:e=>e.toLowerCase().includes("wms"),create:e=>new re(e)};class re extends s{url;data;substituteCRS84;flipCRS;wmsParameters;vendorParameters;capabilities=null;constructor(e){super(e),this.url=e.url,this.data=e.url,this.substituteCRS84=e.substituteCRS84??!1,this.flipCRS=["EPSG:4326"],this.wmsParameters={layers:void 0,query_layers:void 0,styles:void 0,version:"1.3.0",crs:"EPSG:4326",format:"image/png",info_format:"text/plain",transparent:void 0,time:void 0,elevation:void 0,...e.wmsParameters},this.vendorParameters=e.vendorParameters||{}}async getMetadata(){const e=await this.getCapabilities();return this.normalizeMetadata(e)}async getImage(e){const{boundingBox:t,bbox:r,...s}=e,n={bbox:t?[...t[0],...t[1]]:r,...s};return await this.getMap(n)}normalizeMetadata(e){return e}async getCapabilities(e,t){const r=this.getCapabilitiesURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();this._checkResponse(s,n);const o=await T.parse(n,this.loadOptions);return this.capabilities=o,o}async getMap(e,t){const r=this.getMapURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();this._checkResponse(s,n);try{return await a.parse(n,this.loadOptions)}catch{throw this._parseError(n)}}async getFeatureInfo(e,t){const r=this.getFeatureInfoURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();return this._checkResponse(s,n),await B.parse(n,this.loadOptions)}async getFeatureInfoText(e,t){const r=this.getFeatureInfoURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();return this._checkResponse(s,n),(new TextDecoder).decode(n)}async describeLayer(e,t){const r=this.describeLayerURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();return this._checkResponse(s,n),await U.parse(n,this.loadOptions)}async getLegendGraphic(e,t){const r=this.getLegendGraphicURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();this._checkResponse(s,n);try{return await a.parse(n,this.loadOptions)}catch{throw this._parseError(n)}}getCapabilitiesURL(e,t){const r={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetCapabilities",r,t)}getMapURL(e,t){e=this._getWMS130Parameters(e);const r={version:this.wmsParameters.version,format:this.wmsParameters.format,transparent:this.wmsParameters.transparent,time:this.wmsParameters.time,elevation:this.wmsParameters.elevation,layers:this.wmsParameters.layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetMap",r,t)}getFeatureInfoURL(e,t){e=this._getWMS130Parameters(e);const{boundingBox:r,bbox:s}=e;e.bbox=r?[...r[0],...r[1]]:s;const n={version:this.wmsParameters.version,info_format:this.wmsParameters.info_format,layers:this.wmsParameters.layers,query_layers:this.wmsParameters.query_layers,styles:this.wmsParameters.styles,crs:this.wmsParameters.crs,...e};return this._getWMSUrl("GetFeatureInfo",n,t)}describeLayerURL(e,t){const r={version:this.wmsParameters.version,...e};return this._getWMSUrl("DescribeLayer",r,t)}getLegendGraphicURL(e,t){const r={version:this.wmsParameters.version,...e};return this._getWMSUrl("GetLegendGraphic",r,t)}_parseWMSUrl(e){const[t,r]=e.split("?"),s=r.split("&"),n={};for(const e of s){const[t,r]=e.split("=");n[t]=r}return{url:t,parameters:n}}_getWMSUrl(e,t,r){let s=this.url,n=!0;const o={service:"WMS",version:t.version,request:e,...t,...this.vendorParameters,...r},a=["transparent","time","elevation"];for(const[e,r]of Object.entries(o))a.includes(e)&&!r||(s+=n?"?":"&",n=!1,s+=this._getURLParameter(e,r,t));return encodeURI(s)}_getWMS130Parameters(e){const t={...e};return t.srs&&(t.crs=t.crs||t.srs,delete t.srs),t}_getURLParameter(e,t,r){switch(e){case"crs":"1.3.0"!==r.version?e="srs":this.substituteCRS84&&"EPSG:4326"===t&&(t="CRS:84");break;case"srs":"1.3.0"===r.version&&(e="crs");break;case"bbox":const s=this._flipBoundingBox(t,r);s&&(t=s);break;case"x":"1.3.0"===r.version&&(e="i");break;case"y":"1.3.0"===r.version&&(e="j")}return e=e.toUpperCase(),Array.isArray(t)?`${e}=${t.join(",")}`:`${e}=${t?String(t):""}`}_flipBoundingBox(e,t){if(!Array.isArray(e)||4!==e.length)return null;const r=e;return"1.3.0"===t.version&&this.flipCRS.includes(t.crs||"")&&!(this.substituteCRS84&&"EPSG:4326"===t.crs)?[r[1],r[0],r[3],r[2]]:r}async _fetchArrayBuffer(e){const t=await this.fetch(e),r=await t.arrayBuffer();return this._checkResponse(t,r),r}_checkResponse(e,t){const r=e.headers["content-type"];if(!e.ok||h.mimeTypes.includes(r)){const e=n(this.loadOptions,{wms:{throwOnError:!0}}),r=h.parseSync?.(t,e);throw new Error(r)}}_parseError(e){const t=h.parseSync?.(e,this.loadOptions);return new Error(t)}}class se extends s{static type="template";static testURL=e=>e.toLowerCase().includes("{");constructor(e){super(e)}async getMetadata(){throw new Error("ImageSource.getMetadata not implemented")}async getImage(e){const t=this.getGranularParameters(e),r=this.getURLFromTemplate(t),s=await this.fetch(r),n=await s.arrayBuffer();return await a.parse(n)}getGranularParameters(e){const[[t,r],[s,n]]=e.boundingBox;return{...e,east:t,north:r,south:n,west:s}}getURLFromTemplate(e){let t=this.props.url;for(const[r,s]of Object.entries(e))t=t.replace(`\${${r}}`,String(s)),t=t.replace(`{${r}}`,String(s));return t}}class ne extends se{data;constructor(e){super(e),this.data=e.url}async getMetadata(){return await this.metadata()}async getImage(e){throw new Error("not implemented")}async metadata(){throw new Error("not implemented")}exportImage(e){throw new Error("not implemented")}metadataURL(e){return`${this.props.url}?f=pjson`}exportImageURL(e){const t=`bbox=${e.bbox[0]},${e.bbox[1]},${e.bbox[2]},${e.bbox[3]}`,r=`size=${e.width},${e.height}`,s={...e,bbox:t,size:r};return delete s.width,delete s.height,this.getUrl("exportImage",s)}getUrl(e,t,r){let s=`${this.props.url}/${e}`,n=!0;for(const[e,r]of Object.entries(t))s+=n?"?":"&",n=!1,Array.isArray(r)?s+=`${e.toUpperCase()}=${r.join(",")}`:s+=`${e.toUpperCase()}=${r?String(r):""}`;return s}async checkResponse(e){if(!e.ok)throw new Error("error")}}const oe={type:"arcgis-image-server",testURL:e=>e.toLowerCase().includes("ImageServer"),create:e=>new ne(e)},ae=[te,oe];function ie(e){return ee(e,ae)}class ce extends o{static type="csw";static testURL=e=>e.toLowerCase().includes("csw");capabilities=null;data;url;loaders=[h,l];constructor(e){super(e),this.url=e.url,this.data=e.url}async getMetadata(){const e=await this.getCapabilities();return this.normalizeMetadata(e)}normalizeMetadata(e){return e}async getServiceDirectory(e){const t=[],r=[],s=await this.getRecords();for(const e of s.records)for(const s of e.references){const n=s.value;switch(s.scheme){case"OGC:WMS":t.push({name:e.title,type:"ogc-wms-service",...this._parseOGCUrl(n)});break;case"OGC:WMTS":t.push({name:e.title,type:"ogc-wmts-service",...this._parseOGCUrl(n)});break;case"OGC:WFS":t.push({name:e.title,type:"ogc-wfs-service",...this._parseOGCUrl(n)});break;default:r.push({name:e.title,type:"unknown",url:s.value,scheme:s.scheme})}}return e?.includeUnknown?t.concat(r):t}_parseOGCUrl(e){const t=e.split("?");return{url:t[0],params:t[1]||""}}async getCapabilities(e,t){const r=this.getCapabilitiesURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();this._checkResponse(s,n);return await l.parse(n,this.props.loadOptions)}async getRecords(e,t){const r=this.getRecordsURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();return this._checkResponse(s,n),await f.parse(n,this.props.loadOptions)}async getDomain(e,t){const r=this.getDomainURL(e,t),s=await this.fetch(r),n=await s.arrayBuffer();return this._checkResponse(s,n),await p.parse(n,this.props.loadOptions)}getCapabilitiesURL(e,t){const r={version:"3.0.0",...e,...t,service:"CSW",request:"GetCapabilities"};return this._getCSWUrl(r,t)}getRecordsURL(e,t){const r={version:"3.0.0",typenames:"csw:Record",...e,...t,service:"CSW",request:"GetRecords"};return this._getCSWUrl(r,t)}getDomainURL(e,t){const r={version:"3.0.0",...e,...t,service:"CSW",request:"GetDomain"};return this._getCSWUrl(r,t)}_getCSWUrl(e,t){let r=this.props.url,s=!0;for(const[t,n]of Object.entries(e))r+=s?"?":"&",s=!1,Array.isArray(n)?r+=`${t.toUpperCase()}=${n.join(",")}`:r+=`${t.toUpperCase()}=${n?String(n):""}`;return encodeURI(r)}_checkResponse(e,t){const r=e.headers["content-type"];if(!e.ok||h.mimeTypes.includes(r)){const e=h.parseSync?.(t,this.props.loadOptions);throw new Error(e)}}_parseError(e){const t=h.parseSync?.(e,this.props.loadOptions);return new Error(t)}}async function le(e,t=fetch){if(e.includes("rest/services")){return ue(e.replace(/rest\/services.*$/i,"rest/services"),t,[])}return null}async function ue(e,t,r){const s=`${e}/${r.join("/")}`,n=await t(`${s}?f=pjson`),o=await n.json(),a=function(e,t){const r=e.services||[],s=[];for(const e of r)s.push({name:e.name,type:`arcgis-${e.type.toLocaleLowerCase().replace("server","-server")}`,url:`${t}${e.name}/${e.type}`});return s}(o,s),i=(o.folders||[]).map((s=>ue(`${e}`,t,[...r,s])));for(const e of await Promise.all(i))a.push(...e);return a}export{l as CSWCapabilitiesLoader,p as CSWDomainLoader,f as CSWRecordsLoader,ce as CSWService,se as ImageService,T as WMSCapabilitiesLoader,h as WMSErrorLoader,te as WMSService,re as WMSSource,oe as _ArcGISImageService,Z as _GMLLoader,O as _WFSCapabilitiesLoader,B as _WMSFeatureInfoLoader,U as _WMSLayerDescriptionLoader,le as _getArcGISServices,ee as createImageService,ie as createImageSource};export default null;
