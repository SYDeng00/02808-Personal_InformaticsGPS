/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@loaders.gl/xml@4.2.0/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{XMLParser as t}from"../../fast-xml-parser@4.3.6/_esm.js";import{mergeLoaderOptions as s}from"../loader-utils@4.2.0/_esm.js";const i={ontext:()=>{},onprocessinginstruction:()=>{},onsgmldeclaration:()=>{},ondoctype:()=>{},oncomment:()=>{},onopentagstart:()=>{},onattribute:()=>{},onopentag:()=>{},onclosetag:()=>{},onopencdata:()=>{},oncdata:()=>{},onclosecdata:()=>{},onerror:()=>{},onend:()=>{},onready:()=>{},onscript:()=>{},onopennamespace:()=>{},onclosenamespace:()=>{}},e={...i,strict:!1,MAX_BUFFER_LENGTH:65536,lowercase:!1,lowercasetags:!1,noscript:!1,strictEntities:!1,xmlns:void 0,position:void 0,trim:void 0,normalize:void 0},a=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],h=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"],o=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,n=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,r=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,c=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,l={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830};Object.keys(l).forEach((t=>{const s=l[t];l[t]="number"==typeof s?String.fromCharCode(s):s}));class u{EVENTS=a;ENTITIES={...l};XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"};S=0;opt;trackPosition=!1;column=0;line=0;c="";error;q="";bufferCheckPosition;closed=!1;tags=[];looseCase="";closedRoot=!1;sawRoot=!1;strict=!1;tag;strictEntities;state;noscript=!1;attribList=[];ns;position=0;STATE={BEGIN:this.S++,BEGIN_WHITESPACE:this.S++,TEXT:this.S++,TEXT_ENTITY:this.S++,OPEN_WAKA:this.S++,SGML_DECL:this.S++,SGML_DECL_QUOTED:this.S++,DOCTYPE:this.S++,DOCTYPE_QUOTED:this.S++,DOCTYPE_DTD:this.S++,DOCTYPE_DTD_QUOTED:this.S++,COMMENT_STARTING:this.S++,COMMENT:this.S++,COMMENT_ENDING:this.S++,COMMENT_ENDED:this.S++,CDATA:this.S++,CDATA_ENDING:this.S++,CDATA_ENDING_2:this.S++,PROC_INST:this.S++,PROC_INST_BODY:this.S++,PROC_INST_ENDING:this.S++,OPEN_TAG:this.S++,OPEN_TAG_SLASH:this.S++,ATTRIB:this.S++,ATTRIB_NAME:this.S++,ATTRIB_NAME_SAW_WHITE:this.S++,ATTRIB_VALUE:this.S++,ATTRIB_VALUE_QUOTED:this.S++,ATTRIB_VALUE_CLOSED:this.S++,ATTRIB_VALUE_UNQUOTED:this.S++,ATTRIB_VALUE_ENTITY_Q:this.S++,ATTRIB_VALUE_ENTITY_U:this.S++,CLOSE_TAG:this.S++,CLOSE_TAG_SAW_WHITE:this.S++,SCRIPT:this.S++,SCRIPT_ENDING:this.S++};BUFFERS=h;CDATA="[CDATA[";DOCTYPE="DOCTYPE";XML_NAMESPACE="http://www.w3.org/XML/1998/namespace";XMLNS_NAMESPACE="http://www.w3.org/2000/xmlns/";rootNS={xml:this.XML_NAMESPACE,xmlns:this.XMLNS_NAMESPACE};comment;sgmlDecl;textNode="";tagName;doctype;procInstName;procInstBody;entity="";attribName;attribValue;cdata="";script="";startTagPosition=0;constructor(){this.S=0;for(const t in this.STATE)this.STATE.hasOwnProperty(t)&&(this.STATE[this.STATE[t]]=t);this.S=this.STATE}static charAt(t,s){let i="";return s<t.length&&(i=t.charAt(s)),i}static isWhitespace(t){return" "===t||"\n"===t||"\r"===t||"\t"===t}static isQuote(t){return'"'===t||"'"===t}static isAttribEnd(t){return">"===t||u.isWhitespace(t)}static isMatch(t,s){return t.test(s)}static notMatch(t,s){return!u.isMatch(t,s)}static qname(t,s){const i=t.indexOf(":")<0?["",t]:t.split(":");let e=i[0],a=i[1];return s&&"xmlns"===t&&(e="xmlns",a=""),{prefix:e,local:a}}write(t){if(this.error)throw this.error;if(this.closed)return this.errorFunction("Cannot write after close. Assign an onready handler.");if(null===t)return this.end();"object"==typeof t&&(t=t.toString());let s,i=0;for(;s=u.charAt(t,i++),this.c=s,s;)switch(this.trackPosition&&(this.position++,"\n"===s?(this.line++,this.column=0):this.column++),this.state){case this.S.BEGIN:if(this.state=this.S.BEGIN_WHITESPACE,"\ufeff"===s)continue;this.beginWhiteSpace(s);continue;case this.S.BEGIN_WHITESPACE:this.beginWhiteSpace(s);continue;case this.S.TEXT:if(this.sawRoot&&!this.closedRoot){const e=i-1;for(;s&&"<"!==s&&"&"!==s;)s=u.charAt(t,i++),s&&this.trackPosition&&(this.position++,"\n"===s?(this.line++,this.column=0):this.column++);this.textNode+=t.substring(e,i-1)}"<"!==s||this.sawRoot&&this.closedRoot&&!this.strict?(u.isWhitespace(s)||this.sawRoot&&!this.closedRoot||this.strictFail("Text data outside of root node."),"&"===s?this.state=this.S.TEXT_ENTITY:this.textNode+=s):(this.state=this.S.OPEN_WAKA,this.startTagPosition=this.position);continue;case this.S.SCRIPT:"<"===s?this.state=this.S.SCRIPT_ENDING:this.script+=s;continue;case this.S.SCRIPT_ENDING:"/"===s?this.state=this.S.CLOSE_TAG:(this.script+=`<${s}`,this.state=this.S.SCRIPT);continue;case this.S.OPEN_WAKA:if("!"===s)this.state=this.S.SGML_DECL,this.sgmlDecl="";else if(u.isWhitespace(s));else if(u.isMatch(o,s))this.state=this.S.OPEN_TAG,this.tagName=s;else if("/"===s)this.state=this.S.CLOSE_TAG,this.tagName="";else if("?"===s)this.state=this.S.PROC_INST,this.procInstName=this.procInstBody="";else{if(this.strictFail("Unencoded <"),this.startTagPosition+1<this.position){const t=this.position-this.startTagPosition;s=new Array(t).join(" ")+s}this.textNode+=`<${s}`,this.state=this.S.TEXT}continue;case this.S.SGML_DECL:(this.sgmlDecl+s).toUpperCase()===this.CDATA?(this.emitNode("onopencdata"),this.state=this.S.CDATA,this.sgmlDecl="",this.cdata=""):this.sgmlDecl+s==="--"?(this.state=this.S.COMMENT,this.comment="",this.sgmlDecl=""):(this.sgmlDecl+s).toUpperCase()===this.DOCTYPE?(this.state=this.S.DOCTYPE,(this.doctype||this.sawRoot)&&this.strictFail("Inappropriately located doctype declaration"),this.doctype="",this.sgmlDecl=""):">"===s?(this.emitNode("onsgmldeclaration",this.sgmlDecl),this.sgmlDecl="",this.state=this.S.TEXT):u.isQuote(s)?(this.state=this.S.SGML_DECL_QUOTED,this.sgmlDecl+=s):this.sgmlDecl+=s;continue;case this.S.SGML_DECL_QUOTED:s===this.q&&(this.state=this.S.SGML_DECL,this.q=""),this.sgmlDecl+=s;continue;case this.S.DOCTYPE:">"===s?(this.state=this.S.TEXT,this.emitNode("ondoctype",this.doctype),this.doctype=!0):(this.doctype+=s,"["===s?this.state=this.S.DOCTYPE_DTD:u.isQuote(s)&&(this.state=this.S.DOCTYPE_QUOTED,this.q=s));continue;case this.S.DOCTYPE_QUOTED:this.doctype+=s,s===this.q&&(this.q="",this.state=this.S.DOCTYPE);continue;case this.S.DOCTYPE_DTD:this.doctype+=s,"]"===s?this.state=this.S.DOCTYPE:u.isQuote(s)&&(this.state=this.S.DOCTYPE_DTD_QUOTED,this.q=s);continue;case this.S.DOCTYPE_DTD_QUOTED:this.doctype+=s,s===this.q&&(this.state=this.S.DOCTYPE_DTD,this.q="");continue;case this.S.COMMENT:"-"===s?this.state=this.S.COMMENT_ENDING:this.comment+=s;continue;case this.S.COMMENT_ENDING:"-"===s?(this.state=this.S.COMMENT_ENDED,this.comment=this.textApplyOptions(this.comment),this.comment&&this.emitNode("oncomment",this.comment),this.comment=""):(this.comment+=`-${s}`,this.state=this.S.COMMENT);continue;case this.S.COMMENT_ENDED:">"!==s?(this.strictFail("Malformed comment"),this.comment+=`--${s}`,this.state=this.S.COMMENT):this.state=this.S.TEXT;continue;case this.S.CDATA:"]"===s?this.state=this.S.CDATA_ENDING:this.cdata+=s;continue;case this.S.CDATA_ENDING:"]"===s?this.state=this.S.CDATA_ENDING_2:(this.cdata+=`]${s}`,this.state=this.S.CDATA);continue;case this.S.CDATA_ENDING_2:">"===s?(this.cdata&&this.emitNode("oncdata",this.cdata),this.emitNode("onclosecdata"),this.cdata="",this.state=this.S.TEXT):"]"===s?this.cdata+="]":(this.cdata+=`]]${s}`,this.state=this.S.CDATA);continue;case this.S.PROC_INST:"?"===s?this.state=this.S.PROC_INST_ENDING:u.isWhitespace(s)?this.state=this.S.PROC_INST_BODY:this.procInstName+=s;continue;case this.S.PROC_INST_BODY:if(!this.procInstBody&&u.isWhitespace(s))continue;"?"===s?this.state=this.S.PROC_INST_ENDING:this.procInstBody+=s;continue;case this.S.PROC_INST_ENDING:">"===s?(this.emitNode("onprocessinginstruction",{name:this.procInstName,body:this.procInstBody}),this.procInstName=this.procInstBody="",this.state=this.S.TEXT):(this.procInstBody+=`?${s}`,this.state=this.S.PROC_INST_BODY);continue;case this.S.OPEN_TAG:u.isMatch(n,s)?this.tagName+=s:(this.newTag(),">"===s?this.openTag():"/"===s?this.state=this.S.OPEN_TAG_SLASH:(u.isWhitespace(s)||this.strictFail("Invalid character in tag name"),this.state=this.S.ATTRIB));continue;case this.S.OPEN_TAG_SLASH:">"===s?(this.openTag(!0),this.closeTag()):(this.strictFail("Forward-slash in opening tag not followed by >"),this.state=this.S.ATTRIB);continue;case this.S.ATTRIB:if(u.isWhitespace(s))continue;">"===s?this.openTag():"/"===s?this.state=this.S.OPEN_TAG_SLASH:u.isMatch(o,s)?(this.attribName=s,this.attribValue="",this.state=this.S.ATTRIB_NAME):this.strictFail("Invalid attribute name");continue;case this.S.ATTRIB_NAME:"="===s?this.state=this.S.ATTRIB_VALUE:">"===s?(this.strictFail("Attribute without value"),this.attribValue=this.attribName,this.attrib(),this.openTag()):u.isWhitespace(s)?this.state=this.S.ATTRIB_NAME_SAW_WHITE:u.isMatch(n,s)?this.attribName+=s:this.strictFail("Invalid attribute name");continue;case this.S.ATTRIB_NAME_SAW_WHITE:if("="===s)this.state=this.S.ATTRIB_VALUE;else{if(u.isWhitespace(s))continue;this.strictFail("Attribute without value"),this.tag.attributes[this.attribName]="",this.attribValue="",this.emitNode("onattribute",{name:this.attribName,value:""}),this.attribName="",">"===s?this.openTag():u.isMatch(o,s)?(this.attribName=s,this.state=this.S.ATTRIB_NAME):(this.strictFail("Invalid attribute name"),this.state=this.S.ATTRIB)}continue;case this.S.ATTRIB_VALUE:if(u.isWhitespace(s))continue;u.isQuote(s)?(this.q=s,this.state=this.S.ATTRIB_VALUE_QUOTED):(this.strictFail("Unquoted attribute value"),this.state=this.S.ATTRIB_VALUE_UNQUOTED,this.attribValue=s);continue;case this.S.ATTRIB_VALUE_QUOTED:if(s!==this.q){"&"===s?this.state=this.S.ATTRIB_VALUE_ENTITY_Q:this.attribValue+=s;continue}this.attrib(),this.q="",this.state=this.S.ATTRIB_VALUE_CLOSED;continue;case this.S.ATTRIB_VALUE_CLOSED:u.isWhitespace(s)?this.state=this.S.ATTRIB:">"===s?this.openTag():"/"===s?this.state=this.S.OPEN_TAG_SLASH:u.isMatch(o,s)?(this.strictFail("No whitespace between attributes"),this.attribName=s,this.attribValue="",this.state=this.S.ATTRIB_NAME):this.strictFail("Invalid attribute name");continue;case this.S.ATTRIB_VALUE_UNQUOTED:if(!u.isAttribEnd(s)){"&"===s?this.state=this.S.ATTRIB_VALUE_ENTITY_U:this.attribValue+=s;continue}this.attrib(),">"===s?this.openTag():this.state=this.S.ATTRIB;continue;case this.S.CLOSE_TAG:if(this.tagName)">"===s?this.closeTag():u.isMatch(n,s)?this.tagName+=s:this.script?(this.script+=`</${this.tagName}`,this.tagName="",this.state=this.S.SCRIPT):(u.isWhitespace(s)||this.strictFail("Invalid tagname in closing tag"),this.state=this.S.CLOSE_TAG_SAW_WHITE);else{if(u.isWhitespace(s))continue;u.notMatch(o,s)?this.script?(this.script+=`</${s}`,this.state=this.S.SCRIPT):this.strictFail("Invalid tagname in closing tag."):this.tagName=s}continue;case this.S.CLOSE_TAG_SAW_WHITE:if(u.isWhitespace(s))continue;">"===s?this.closeTag():this.strictFail("Invalid characters in closing tag");continue;case this.S.TEXT_ENTITY:case this.S.ATTRIB_VALUE_ENTITY_Q:case this.S.ATTRIB_VALUE_ENTITY_U:let e,a;switch(this.state){case this.S.TEXT_ENTITY:e=this.S.TEXT,a="textNode";break;case this.S.ATTRIB_VALUE_ENTITY_Q:e=this.S.ATTRIB_VALUE_QUOTED,a="attribValue";break;case this.S.ATTRIB_VALUE_ENTITY_U:e=this.S.ATTRIB_VALUE_UNQUOTED,a="attribValue";break;default:throw new Error(`Unknown state: ${this.state}`)}";"===s?(this[a]+=this.parseEntity(),this.entity="",this.state=e):u.isMatch(this.entity.length?c:r,s)?this.entity+=s:(this.strictFail("Invalid character in entity name"),this[a]+=`&${this.entity}${s}`,this.entity="",this.state=e);continue;default:throw new Error(`Unknown state: ${this.state}`)}return this.position>=this.bufferCheckPosition&&this.checkBufferLength(),this}emit(t,s){if(this.events.hasOwnProperty(t)){const i=t.replace(/^on/,"");this.events[t](s,i,this)}}clearBuffers(){for(let t=0,s=this.BUFFERS.length;t<s;t++)this[this[t]]=""}flushBuffers(){this.closeText(),""!==this.cdata&&(this.emitNode("oncdata",this.cdata),this.cdata=""),""!==this.script&&(this.emitNode("onscript",this.script),this.script="")}end(){return this.sawRoot&&!this.closedRoot&&this.strictFail("Unclosed root tag"),this.state!==this.S.BEGIN&&this.state!==this.S.BEGIN_WHITESPACE&&this.state!==this.S.TEXT&&this.errorFunction("Unexpected end"),this.closeText(),this.c="",this.closed=!0,this.emit("onend"),new T(this.opt)}errorFunction(t){this.closeText(),this.trackPosition&&(t+=`\nLine: ${this.line}\nColumn: ${this.column}\nChar: ${this.c}`);const s=new Error(t);return this.error=s,this.emit("onerror",s),this}attrib(){if(this.strict||(this.attribName=this.attribName[this.looseCase]()),-1!==this.attribList.indexOf(this.attribName)||this.tag.attributes.hasOwnProperty(this.attribName))this.attribName=this.attribValue="";else{if(this.opt.xmlns){const t=u.qname(this.attribName,!0),s=t.prefix,i=t.local;if("xmlns"===s)if("xml"===i&&this.attribValue!==this.XML_NAMESPACE)this.strictFail(`xml: prefix must be bound to ${this.XML_NAMESPACE}\nActual: ${this.attribValue}`);else if("xmlns"===i&&this.attribValue!==this.XMLNS_NAMESPACE)this.strictFail(`xmlns: prefix must be bound to ${this.XMLNS_NAMESPACE}\nActual: ${this.attribValue}`);else{const t=this.tag,s=this.tags[this.tags.length-1]||this;t.ns===s.ns&&(t.ns=Object.create(s.ns)),t.ns[i]=this.attribValue}this.attribList.push([this.attribName,this.attribValue])}else this.tag.attributes[this.attribName]=this.attribValue,this.emitNode("onattribute",{name:this.attribName,value:this.attribValue});this.attribName=this.attribValue=""}}newTag(){this.strict||(this.tagName=this.tagName[this.looseCase]());const t=this.tags[this.tags.length-1]||this,s=this.tag={name:this.tagName,attributes:{}};this.opt.xmlns&&(s.ns=t.ns),this.attribList.length=0,this.emitNode("onopentagstart",s)}parseEntity(){let t=this.entity;const s=t.toLowerCase();let i=NaN,e="";return this.ENTITIES[t]?this.ENTITIES[t]:this.ENTITIES[s]?this.ENTITIES[s]:(t=s,"#"===t.charAt(0)&&("x"===t.charAt(1)?(t=t.slice(2),i=parseInt(t,16),e=i.toString(16)):(t=t.slice(1),i=parseInt(t,10),e=i.toString(10))),t=t.replace(/^0+/,""),isNaN(i)||e.toLowerCase()!==t?(this.strictFail("Invalid character entity"),`&${this.entity};`):String.fromCodePoint(i))}beginWhiteSpace(t){"<"===t?(this.state=this.S.OPEN_WAKA,this.startTagPosition=this.position):u.isWhitespace(t)||(this.strictFail("Non-whitespace before first tag."),this.textNode=t,this.state=this.S.TEXT)}strictFail(t){if("object"!=typeof this||!(this instanceof T))throw new Error("bad call to strictFail");this.strict&&this.errorFunction(t)}textApplyOptions(t){return this.opt.trim&&(t=t.trim()),this.opt.normalize&&(t=t.replace(/\s+/g," ")),t}emitNode(t,s){this.textNode&&this.closeText(),this.emit(t,s)}closeText(){this.textNode=this.textApplyOptions(this.textNode),void 0!==this.textNode&&""!==this.textNode&&"undefined"!==this.textNode&&this.emit("ontext",this.textNode),this.textNode=""}checkBufferLength(){const t=Math.max(this.opt.MAX_BUFFER_LENGTH,10);let s=0;for(let i=0,e=this.BUFFERS.length;i<e;i++){const e=this[this.BUFFERS[i]]?.length||0;if(e>t)switch(this.BUFFERS[i]){case"textNode":this.closeText();break;case"cdata":this.emitNode("oncdata",this.cdata),this.cdata="";break;case"script":this.emitNode("onscript",this.script),this.script="";break;default:this.errorFunction(`Max buffer length exceeded: ${this.BUFFERS[i]}`)}s=Math.max(s,e)}const i=this.opt.MAX_BUFFER_LENGTH-s;this.bufferCheckPosition=i+this.position}openTag(t){if(this.opt.xmlns){const t=this.tag,s=u.qname(this.tagName);t.prefix=s.prefix,t.local=s.local,t.uri=t.ns[s.prefix]||"",t.prefix&&!t.uri&&(this.strictFail(`Unbound namespace prefix: ${JSON.stringify(this.tagName)}`),t.uri=s.prefix);const i=this.tags[this.tags.length-1]||this;if(t.ns&&i.ns!==t.ns){const s=this;Object.keys(t.ns).forEach((i=>{s.emitNode("onopennamespace",{prefix:i,uri:t.ns[i]})}))}for(let s=0,i=this.attribList.length;s<i;s++){const i=this.attribList[s],e=i[0],a=i[1],h=u.qname(e,!0),o=h.prefix,n=h.local,r=""===o?"":t.ns[o]||"",c={name:e,value:a,prefix:o,local:n,uri:r};o&&"xmlns"!==o&&!r&&(this.strictFail(`Unbound namespace prefix: ${JSON.stringify(o)}`),c.uri=o),this.tag.attributes[e]=c,this.emitNode("onattribute",c)}this.attribList.length=0}this.tag.isSelfClosing=Boolean(t),this.sawRoot=!0,this.tags.push(this.tag),this.emitNode("onopentag",this.tag),t||(this.noscript||"script"!==this.tagName.toLowerCase()?this.state=this.S.TEXT:this.state=this.S.SCRIPT,this.tag=null,this.tagName=""),this.attribName=this.attribValue="",this.attribList.length=0}closeTag(){if(!this.tagName)return this.strictFail("Weird empty close tag."),this.textNode+="</>",void(this.state=this.S.TEXT);if(this.script){if("script"!==this.tagName)return this.script+=`</${this.tagName}>`,this.tagName="",void(this.state=this.S.SCRIPT);this.emitNode("onscript",this.script),this.script=""}let t=this.tags.length,s=this.tagName;for(this.strict||(s=s[this.looseCase]());t--;){if(this.tags[t].name===s)break;this.strictFail("Unexpected close tag")}if(t<0)return this.strictFail(`Unmatched closing tag: ${this.tagName}`),this.textNode+=`</${this.tagName}>`,void(this.state=this.S.TEXT);this.tagName=s;let i=this.tags.length;for(;i-- >t;){const t=this.tag=this.tags.pop();this.tagName=this.tag.name,this.emitNode("onclosetag",this.tagName);for(const s in t.ns)t.ns.hasOwnProperty(s)&&t.ns[s];const s=this.tags[this.tags.length-1]||this;if(this.opt.xmlns&&t.ns!==s.ns){const s=this;Object.keys(t.ns).forEach((i=>{const e=t.ns[i];s.emitNode("onclosenamespace",{prefix:i,uri:e})}))}}0===t&&(this.closedRoot=!0),this.tagName=this.attribValue=this.attribName="",this.attribList.length=0,this.state=this.S.TEXT}}class T extends u{static ENTITIES=l;opt=e;events=i;constructor(t){super(),this.clearBuffers(),this.opt=t={...this.opt,...t},this.events={...this.events,...t},this.q=this.c="",this.opt.lowercase=this.opt.lowercase||this.opt.lowercasetags,this.bufferCheckPosition=this.opt.MAX_BUFFER_LENGTH,this.looseCase=this.opt.lowercase?"toLowerCase":"toUpperCase",this.tags=[],this.closed=this.closedRoot=this.sawRoot=!1,this.tag=this.error=null,this.strict=Boolean(this.opt.strict),this.noscript=Boolean(this.opt.strict||this.opt.noscript),this.state=this.S.BEGIN,this.strictEntities=this.opt.strictEntities,this.ENTITIES=this.strictEntities?Object.create(this.XML_ENTITIES):Object.create(this.ENTITIES),this.attribList=[],this.opt.xmlns&&(this.ns=Object.create(this.rootNS)),this.trackPosition=!1!==this.opt.position,this.trackPosition&&(this.position=this.line=this.column=0),this.emit("onready")}resume(){return this.error=null,this}close(){return this.write(null)}flush(){this.flushBuffers()}}function m(t){return"string"==typeof t?t.charAt(0).toLowerCase()+t.slice(1):t}function p(t){if(Array.isArray(t))return t.map((t=>p(t)));if(t&&"object"==typeof t){const s={};for(const[i,e]of Object.entries(t))s[m(i)]=p(e);return s}return t}function E(s,i){if(i?._parser&&"fast-xml-parser"!==i._parser)throw new Error(i?._parser);const e=function(s,i){const e=new t({ignoreAttributes:!1,attributeNamePrefix:"",...i}),a=e.parse(s);return a}(s,{allowBooleanAttributes:!0,ignoreDeclaration:!0,removeNSPrefix:i?.removeNSPrefix,textNodeName:i?.textNodeName,isArray:(t,s,e,a)=>Boolean(i?.arrayPaths?.some((t=>s===t))),...i?._fastXML});return i?.uncapitalizeKeys?p(e):e}const S={dataType:null,batchType:null,name:"XML",id:"xml",module:"xml",version:"4.2.0-beta.2",worker:!1,extensions:["xml"],mimeTypes:["application/xml","text/xml"],testText:function(t){return t.startsWith("<?xml")},options:{xml:{_parser:"fast-xml-parser",uncapitalizeKeys:!1,removeNSPrefix:!1,textNodeName:"value",arrayPaths:[]}},parse:async(t,s)=>E((new TextDecoder).decode(t),{...S.options.xml,...s?.xml}),parseTextSync:(t,s)=>E(t,{...S.options.xml,...s?.xml})};const N={...S,name:"HTML",id:"html",extensions:["html","htm"],mimeTypes:["text/html"],testText:function(t){return t.startsWith("<html")},parse:async(t,s)=>d((new TextDecoder).decode(t),s),parseTextSync:(t,s)=>d(t,s)};function d(t,i){return i=s(i,{xml:{_parser:"fast-xml-parser",_fastXML:{htmlEntities:!0}}}),S.parseTextSync?.(t,i)}function A(t){return Array.isArray(t)?t:(t&&"object"==typeof t&&t[0],t?[t]:[])}function g(t,s){t[s]=A(t[s])}export{N as HTMLLoader,T as SAXParser,S as XMLLoader,m as _uncapitalize,p as _uncapitalizeKeys,g as convertXMLFieldToArrayInPlace,A as convertXMLValueToArray};export default null;
