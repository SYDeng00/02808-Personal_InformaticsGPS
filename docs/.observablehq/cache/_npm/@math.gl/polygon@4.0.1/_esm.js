/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@math.gl/polygon@4.0.1/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{equals as t,isArray as n}from"../core@4.0.1/_esm.js";const e={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function r(t,n,e={}){return o(t,e)!==n&&(function(t,n){const{start:e=0,end:r=t.length,size:o=2}=n,s=(r-e)/o,i=Math.floor(s/2);for(let n=0;n<i;++n){const r=e+n*o,i=e+(s-1-n)*o;for(let n=0;n<o;++n){const e=t[r+n];t[r+n]=t[i+n],t[i+n]=e}}}(t,e),!0)}function o(t,n={}){return Math.sign(i(t,n))}const s={x:0,y:1,z:2};function i(t,n={}){const{start:e=0,end:r=t.length,plane:o="xy"}=n,i=n.size||2;let l=0;const u=s[o[0]],x=s[o[1]];for(let n=e,o=r-i;n<r;n+=i)l+=(t[n+u]-t[o+u])*(t[n+x]+t[o+x]),o=n;return l/2}function l(n,e,r={}){const{start:o=0,end:s=n.length,size:i=2,isClosed:l}=r,u=(s-o)/i;for(let t=0;t<u-1;++t)e(n[o+t*i],n[o+t*i+1],n[o+(t+1)*i],n[o+(t+1)*i+1],t,t+1);const x=o+(u-1)*i;l||t(n[o],n[x])&&t(n[o+1],n[x+1])||e(n[x],n[x+1],n[o],n[o+1],u-1,0)}function u(t,n,e={}){const r=function(t,n={}){return Math.sign(x(t,n))}(t,e);return r!==n&&(t.reverse(),!0)}function x(t,n={}){const{start:e=0,end:r=t.length,plane:o="xy"}=n;let i=0;const l=s[o[0]],u=s[o[1]];for(let n=e,o=r-1;n<r;++n)i+=(t[n][l]-t[o][l])*(t[n][u]+t[o][u]),o=n;return i/2}class f{constructor(t,e={}){this.points=t,this.isFlatArray=!n(t[0]),this.options={start:e.start||0,end:e.end||t.length,size:e.size||2,isClosed:e.isClosed},Object.freeze(this)}getSignedArea(){return this.isFlatArray?i(this.points,this.options):x(this.points,this.options)}getArea(){return Math.abs(this.getSignedArea())}getWindingDirection(){return Math.sign(this.getSignedArea())}forEachSegment(n){this.isFlatArray?l(this.points,((t,e,r,o,s,i)=>{n([t,e],[r,o],s,i)}),this.options):function(n,e,r={}){const{start:o=0,end:s=n.length,isClosed:i}=r;for(let t=o;t<s-1;++t)e(n[t],n[t+1],t,t+1);i||t(n[s-1],n[0])||e(n[s-1],n[0],s-1,0)}(this.points,n,this.options)}modifyWindingDirection(t){return this.isFlatArray?r(this.points,t,this.options):u(this.points,t,this.options)}}function c(t,n,e=2,r,o="xy"){const s=n&&n.length,i=s?n[0]*e:t.length;let l=h(t,0,i,e,!0,r&&r[0],o);const u=[];if(!l||l.next===l.prev)return u;let x,f,c,p,a,g,d;if(s&&(l=function(t,n,e,r,o,s){const i=[];let l,u,x,f,c;for(l=0,u=n.length;l<u;l++)x=n[l]*r,f=l<u-1?n[l+1]*r:t.length,c=h(t,x,f,r,!1,o&&o[l+1],s),c===c.next&&(c.steiner=!0),i.push(w(c));for(i.sort(z),l=0;l<i.length;l++)e=Z(i[l],e);return e}(t,n,l,e,r,o)),t.length>80*e){p=f=t[0],a=c=t[1];for(let n=e;n<i;n+=e)g=t[n],d=t[n+1],g<p&&(p=g),d<a&&(a=d),g>f&&(f=g),d>c&&(c=d);x=Math.max(f-p,c-a),x=0!==x?32767/x:0}return y(l,u,e,p,a,x,0),u}function h(t,n,e,r,o,l,u){let x,f;void 0===l&&(l=i(t,{start:n,end:e,size:r,plane:u}));let c=s[u[0]],h=s[u[1]];if(o===l<0)for(x=n;x<e;x+=r)f=E(x,t[x+c],t[x+h],f);else for(x=e-r;x>=n;x-=r)f=E(x,t[x+c],t[x+h],f);return f&&C(f,f.next)&&(F(f),f=f.next),f}function p(t,n){if(!t)return t;n||(n=t);let e,r=t;do{if(e=!1,r.steiner||!C(r,r.next)&&0!==A(r.prev,r,r.next))r=r.next;else{if(F(r),r=n=r.prev,r===r.next)break;e=!0}}while(e||r!==n);return n}function y(t,n,e,r,o,s,i){if(!t)return;!i&&s&&function(t,n,e,r){let o=t;do{0===o.z&&(o.z=m(o.x,o.y,n,e,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){let n,e,r,o,s,i,l,u,x=1;do{for(o=t,t=null,u=null,r=0;o;){for(r++,i=o,s=0,e=0;e<x&&(s++,i=i.nextZ,i);e++);for(l=x;s>0||l>0&&i;)0!==s&&(0===l||!i||o.z<=i.z)?(n=o,o=o.nextZ,s--):(n=i,i=i.nextZ,l--),u?u.nextZ=n:t=n,n.prevZ=u,u=n;o=i}u.nextZ=null,x*=2}while(r>1)}(o)}(t,r,o,s);let l,u,x=t;for(;t.prev!==t.next;)if(l=t.prev,u=t.next,s?g(t,r,o,s):a(t))n.push(l.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),F(t),t=u.next,x=u.next;else if((t=u)===x){i?1===i?y(t=d(p(t),n,e),n,e,r,o,s,2):2===i&&v(t,n,e,r,o,s):y(p(t),n,e,r,o,s,1);break}}function a(t){const n=t.prev,e=t,r=t.next;if(A(n,e,r)>=0)return!1;const o=n.x,s=e.x,i=r.x,l=n.y,u=e.y,x=r.y,f=o<s?o<i?o:i:s<i?s:i,c=l<u?l<x?l:x:u<x?u:x,h=o>s?o>i?o:i:s>i?s:i,p=l>u?l>x?l:x:u>x?u:x;let y=r.next;for(;y!==n;){if(y.x>=f&&y.x<=h&&y.y>=c&&y.y<=p&&b(o,l,s,u,i,x,y.x,y.y)&&A(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function g(t,n,e,r){const o=t.prev,s=t,i=t.next;if(A(o,s,i)>=0)return!1;const l=o.x,u=s.x,x=i.x,f=o.y,c=s.y,h=i.y,p=l<u?l<x?l:x:u<x?u:x,y=f<c?f<h?f:h:c<h?c:h,a=l>u?l>x?l:x:u>x?u:x,g=f>c?f>h?f:h:c>h?c:h,d=m(p,y,n,e,r),v=m(a,g,n,e,r);let z=t.prevZ,Z=t.nextZ;for(;z&&z.z>=d&&Z&&Z.z<=v;){if(z.x>=p&&z.x<=a&&z.y>=y&&z.y<=g&&z!==o&&z!==i&&b(l,f,u,c,x,h,z.x,z.y)&&A(z.prev,z,z.next)>=0)return!1;if(z=z.prevZ,Z.x>=p&&Z.x<=a&&Z.y>=y&&Z.y<=g&&Z!==o&&Z!==i&&b(l,f,u,c,x,h,Z.x,Z.y)&&A(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}for(;z&&z.z>=d;){if(z.x>=p&&z.x<=a&&z.y>=y&&z.y<=g&&z!==o&&z!==i&&b(l,f,u,c,x,h,z.x,z.y)&&A(z.prev,z,z.next)>=0)return!1;z=z.prevZ}for(;Z&&Z.z<=v;){if(Z.x>=p&&Z.x<=a&&Z.y>=y&&Z.y<=g&&Z!==o&&Z!==i&&b(l,f,u,c,x,h,Z.x,Z.y)&&A(Z.prev,Z,Z.next)>=0)return!1;Z=Z.nextZ}return!0}function d(t,n,e){let r=t;do{const o=r.prev,s=r.next.next;!C(o,s)&&k(o,r,r.next,s)&&R(o,s)&&R(s,o)&&(n.push(o.i/e|0),n.push(r.i/e|0),n.push(s.i/e|0),F(r),F(r.next),r=t=s),r=r.next}while(r!==t);return p(r)}function v(t,n,e,r,o,s){let i=t;do{let t=i.next.next;for(;t!==i.prev;){if(i.i!==t.i&&I(i,t)){let l=T(i,t);return i=p(i,i.next),l=p(l,l.next),y(i,n,e,r,o,s,0),void y(l,n,e,r,o,s,0)}t=t.next}i=i.next}while(i!==t)}function z(t,n){return t.x-n.x}function Z(t,n){const e=function(t,n){let e=n;const r=t.x,o=t.y;let s,i=-1/0;do{if(o<=e.y&&o>=e.next.y&&e.next.y!==e.y){const t=e.x+(o-e.y)*(e.next.x-e.x)/(e.next.y-e.y);if(t<=r&&t>i&&(i=t,s=e.x<e.next.x?e:e.next,t===r))return s}e=e.next}while(e!==n);if(!s)return null;const l=s,u=s.x,x=s.y;let f,c=1/0;e=s;do{r>=e.x&&e.x>=u&&r!==e.x&&b(o<x?r:i,o,u,x,o<x?i:r,o,e.x,e.y)&&(f=Math.abs(o-e.y)/(r-e.x),R(e,t)&&(f<c||f===c&&(e.x>s.x||e.x===s.x&&M(s,e)))&&(s=e,c=f)),e=e.next}while(e!==l);return s}(t,n);if(!e)return n;const r=T(e,t);return p(r,r.next),p(e,e.next)}function M(t,n){return A(t.prev,t,n.prev)<0&&A(n.next,t,t.next)<0}function m(t,n,e,r,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*o|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function w(t){let n=t,e=t;do{(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next}while(n!==t);return e}function b(t,n,e,r,o,s,i,l){return(o-i)*(n-l)>=(t-i)*(s-l)&&(t-i)*(r-l)>=(e-i)*(n-l)&&(e-i)*(s-l)>=(o-i)*(r-l)}function I(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){let e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&k(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}(t,n)&&(R(t,n)&&R(n,t)&&function(t,n){let e=t,r=!1;const o=(t.x+n.x)/2,s=(t.y+n.y)/2;do{e.y>s!=e.next.y>s&&e.next.y!==e.y&&o<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,n)&&(A(t.prev,t,n.prev)||A(t,n.prev,n))||C(t,n)&&A(t.prev,t,t.next)>0&&A(n.prev,n,n.next)>0)}function A(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function C(t,n){return t.x===n.x&&t.y===n.y}function k(t,n,e,r){const o=S(A(t,n,e)),s=S(A(t,n,r)),i=S(A(e,r,t)),l=S(A(e,r,n));return o!==s&&i!==l||(!(0!==o||!O(t,e,n))||(!(0!==s||!O(t,r,n))||(!(0!==i||!O(e,t,r))||!(0!==l||!O(e,n,r)))))}function O(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function S(t){return t>0?1:t<0?-1:0}function R(t,n){return A(t.prev,t,t.next)<0?A(t,n,t.next)>=0&&A(t,t.prev,n)>=0:A(t,n,t.prev)<0||A(t,t.next,n)<0}function T(t,n){const e=new W(t.i,t.x,t.y),r=new W(n.i,n.x,n.y),o=t.next,s=n.prev;return t.next=n,n.prev=t,e.next=o,o.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function E(t,n,e,r){const o=new W(t,n,e);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function F(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}class W{constructor(t,n,e){this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=n,this.y=e}}function L(t,n){const e=n.length,r=t.length;if(r>0){let o=!0;for(let s=0;s<e;s++)if(t[r-e+s]!==n[s]){o=!1;break}if(o)return!1}for(let o=0;o<e;o++)t[r+o]=n[o];return!0}function D(t,n){const e=n.length;for(let r=0;r<e;r++)t[r]=n[r]}function K(t,n,e,r,o=[]){const s=r+n*e;for(let n=0;n<e;n++)o[n]=t[s+n];return o}function _(t,n,e){const{size:r=2,startIndex:o=0,endIndex:s=t.length}=e||{},i=(s-o)/r,l=[];let u,x,f,c,h=[],p=-1;for(let e=1;e<i;e++){for(u=K(t,e-1,r,o,u),x=K(t,e,r,o,x),p<0&&(p=N(u,n)),f=c=N(x,n);;){if(!(p|f)){L(h,u),f!==c?(L(h,x),e<i-1&&(l.push(h),h=[])):e===i-1&&L(h,x);break}if(p&f)break;p?(q(u,x,p,n,u),p=N(u,n)):(q(u,x,f,n,x),f=N(x,n))}p=c}return h.length&&l.push(h),l}function j(t,n,e){const{size:r=2,endIndex:o=t.length}=e||{};let s,i,l,u,x,{startIndex:f=0}=e||{},c=(o-f)/r;for(let e=1;e<=8;e*=2){s=[],l=K(t,c-1,r,f,l),x=!(N(l,n)&e);for(let o=0;o<c;o++)i=K(t,o,r,f,i),u=!(N(i,n)&e),u!==x&&L(s,q(l,i,e,n)),u&&L(s,i),D(l,i),x=u;if(t=s,f=0,c=s.length/r,!c)break}return s}function q(t,n,e,r,o=[]){let s,i;if(8&e)s=(r[3]-t[1])/(n[1]-t[1]),i=3;else if(4&e)s=(r[1]-t[1])/(n[1]-t[1]),i=1;else if(2&e)s=(r[2]-t[0])/(n[0]-t[0]),i=2;else{if(!(1&e))return null;s=(r[0]-t[0])/(n[0]-t[0]),i=0}for(let e=0;e<t.length;e++)o[e]=(1&i)===e?r[i]:s*(n[e]-t[e])+t[e];return o}function N(t,n){let e=0;return t[0]<n[0]?e|=1:t[0]>n[2]&&(e|=2),t[1]<n[1]?e|=4:t[1]>n[3]&&(e|=8),e}function P(t,n){const{size:e=2,broken:r=!1,gridResolution:o=10,gridOffset:s=[0,0],startIndex:i=0,endIndex:l=t.length}=n||{},u=(l-i)/e;let x=[];const f=[x],c=K(t,0,e,i);let h,p;const y=J(c,o,s,[]),a=[];L(x,c);for(let n=1;n<u;n++){for(h=K(t,n,e,i,h),p=N(h,y);p;){q(c,h,p,y,a);const t=N(a,y);t&&(q(c,a,t,y,a),p=t),L(x,a),D(c,a),Q(y,o,p),r&&x.length>e&&(x=[],f.push(x),L(x,c)),p=N(h,y)}L(x,h),D(c,h)}return r?f:f[0]}const U=0,B=1;function G(t,n=null,e){if(!t.length)return[];const{size:r=2,gridResolution:o=10,gridOffset:s=[0,0],edgeTypes:i=!1}=e||{},l=[],u=[{pos:t,types:i?new Array(t.length/r).fill(B):null,holes:n||[]}],x=[[],[]];let f=[];for(;u.length;){const{pos:t,types:n,holes:e}=u.shift();V(t,r,e[0]||t.length,x),f=J(x[0],o,s,f);const c=N(x[1],f);if(c){let o=H(t,n,r,0,e[0]||t.length,f,c);const s={pos:o[0].pos,types:o[0].types,holes:[]},l={pos:o[1].pos,types:o[1].types,holes:[]};u.push(s,l);for(let u=0;u<e.length;u++)o=H(t,n,r,e[u],e[u+1]||t.length,f,c),o[0]&&(s.holes.push(s.pos.length),s.pos=X(s.pos,o[0].pos),i&&(s.types=X(s.types,o[0].types))),o[1]&&(l.holes.push(l.pos.length),l.pos=X(l.pos,o[1].pos),i&&(l.types=X(l.types,o[1].types)))}else{const r={positions:t};i&&(r.edgeTypes=n),e.length&&(r.holeIndices=e),l.push(r)}}return l}function H(t,n,e,r,o,s,i){const l=(o-r)/e,u=[],x=[],f=[],c=[],h=[];let p,y,a;const g=K(t,l-1,e,r);let d=Math.sign(8&i?g[1]-s[3]:g[0]-s[2]),v=n&&n[l-1],z=0,Z=0;for(let o=0;o<l;o++)p=K(t,o,e,r,p),y=Math.sign(8&i?p[1]-s[3]:p[0]-s[2]),a=n&&n[r/e+o],y&&d&&d!==y&&(q(g,p,i,s,h),L(u,h)&&f.push(v),L(x,h)&&c.push(v)),y<=0?(L(u,p)&&f.push(a),z-=y):f.length&&(f[f.length-1]=U),y>=0?(L(x,p)&&c.push(a),Z+=y):c.length&&(c[c.length-1]=U),D(g,p),d=y,v=a;return[z?{pos:u,types:n&&f}:null,Z?{pos:x,types:n&&c}:null]}function J(t,n,e,r){const o=Math.floor((t[0]-e[0])/n)*n+e[0],s=Math.floor((t[1]-e[1])/n)*n+e[1];return r[0]=o,r[1]=s,r[2]=o+n,r[3]=s+n,r}function Q(t,n,e){8&e?(t[1]+=n,t[3]+=n):4&e?(t[1]-=n,t[3]-=n):2&e?(t[0]+=n,t[2]+=n):1&e&&(t[0]-=n,t[2]-=n)}function V(t,n,e,r){let o=1/0,s=-1/0,i=1/0,l=-1/0;for(let r=0;r<e;r+=n){const n=t[r],e=t[r+1];o=n<o?n:o,s=n>s?n:s,i=e<i?e:i,l=e>l?e:l}return r[0][0]=o,r[0][1]=i,r[1][0]=s,r[1][1]=l,r}function X(t,n){for(let e=0;e<n.length;e++)t.push(n[e]);return t}const Y=85.051129;function $(t,n){const{size:e=2,startIndex:r=0,endIndex:o=t.length,normalize:s=!0}=n||{},i=t.slice(r,o);rt(i,e,0,o-r);const l=P(i,{size:e,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(s)for(const t of l)ot(t,e);return l}function tt(t,n=null,e){const{size:r=2,normalize:o=!0,edgeTypes:s=!1}=e||{};n=n||[];const i=[],l=[];let u=0,x=0;for(let o=0;o<=n.length;o++){const s=n[o]||t.length,f=x,c=nt(t,r,u,s);for(let n=c;n<s;n++)i[x++]=t[n];for(let n=u;n<c;n++)i[x++]=t[n];rt(i,r,f,x),et(i,r,f,x,e?.maxLatitude),u=s,l[o]=x}l.pop();const f=G(i,l,{size:r,gridResolution:360,gridOffset:[-180,-180],edgeTypes:s});if(o)for(const t of f)ot(t.positions,r);return f}function nt(t,n,e,r){let o=-1,s=-1;for(let i=e+1;i<r;i+=n){const n=Math.abs(t[i]);n>o&&(o=n,s=i-1)}return s}function et(t,n,e,r,o=Y){const s=t[e],i=t[r-n];if(Math.abs(s-i)>180){const r=K(t,0,n,e);r[0]+=360*Math.round((i-s)/360),L(t,r),r[1]=Math.sign(r[1])*o,L(t,r),r[0]=s,L(t,r)}}function rt(t,n,e,r){let o,s=t[0];for(let i=e;i<r;i+=n){o=t[i];const n=o-s;(n>180||n<-180)&&(o-=360*Math.round(n/360)),t[i]=s=o}}function ot(t,n){let e;const r=t.length/n;for(let o=0;o<r&&(e=t[o*n],(e+180)%360==0);o++);const o=360*-Math.round(e/360);if(0!==o)for(let e=0;e<r;e++)t[e*n]+=o}export{f as Polygon,e as WINDING,f as _Polygon,j as clipPolygon,_ as clipPolyline,G as cutPolygonByGrid,tt as cutPolygonByMercatorBounds,P as cutPolylineByGrid,$ as cutPolylineByMercatorBounds,c as earcut,l as forEachSegmentInPolygon,i as getPolygonSignedArea,o as getPolygonWindingDirection,r as modifyPolygonWindingDirection};export default null;
