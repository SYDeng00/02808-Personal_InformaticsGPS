/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@luma.gl/core@9.0.9/dist/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import{isBrowser as t}from"../../@probe.gl/env@4.0.9/_esm.js";import{Log as e}from"../../@probe.gl/log@4.0.9/_esm.js";import{Stats as r}from"../../@probe.gl/stats@4.0.9/_esm.js";const n=new e({id:"luma.gl"});class s{stats=new Map;getStats(t){return this.get(t)}get(t){return this.stats.has(t)||this.stats.set(t,new r({id:t})),this.stats.get(t)}}const i=new s;const o=function(){const e="9.0.9";if(globalThis.luma&&globalThis.luma.VERSION!==e)throw new Error(`luma.gl - multiple VERSIONs detected: ${globalThis.luma.VERSION} vs ${e}`);return globalThis.luma||(t()&&n.log(1,`${e} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=globalThis.luma||{VERSION:e,version:e,log:n,stats:i}),e}();function a(t){return!ArrayBuffer.isView(t)||t instanceof DataView?null:t}function c(t){return Array.isArray(t)?0===t.length||"number"==typeof t[0]?t:null:a(t)}const u={};function l(t="id"){u[t]=u[t]||1;return`${t}-${u[t]++}`}function f(t){let e=!0;for(const r in t){e=!1;break}return e}class h{static defaultProps={id:"undefined",handle:void 0,userData:void 0};id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(t,e,r){if(!t)throw new Error("no device");this._device=t,this.props=function(t,e){const r={...e};for(const e in t)void 0!==t[e]&&(r[e]=t[e]);return r}(e,r);const n="undefined"!==this.props.id?this.props.id:l(this[Symbol.toStringTag]);this.props.id=n,this.id=n,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}toString(){return`${this[Symbol.toStringTag]||this.constructor.name}(${this.id})`}getProps(){return this.props}attachResource(t){this._attachedResources.add(t)}detachResource(t){this._attachedResources.delete(t)}destroyAttachedResource(t){this._attachedResources.delete(t)&&t.destroy()}destroyAttachedResources(){for(const t of Object.values(this._attachedResources))t.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get(`${e}s Active`).decrementCount()}trackAllocatedMemory(t,e=this[Symbol.toStringTag]){const r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(t),r.get(`${e} Memory`).addCount(t),this.allocatedBytes=t}trackDeallocatedMemory(t=this[Symbol.toStringTag]){const e=this._device.statsManager.getStats("Resource Counts");e.get("GPU Memory").subtractCount(this.allocatedBytes),e.get(`${t} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){const t=this._device.statsManager.getStats("Resource Counts"),e=this[Symbol.toStringTag];t.get("Resources Created").incrementCount(),t.get(`${e}s Created`).incrementCount(),t.get(`${e}s Active`).incrementCount()}}class d extends h{static defaultProps={...h.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(t,e){const r={...e};(e.usage||0)&d.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?r.indexType="uint32":e.data instanceof Uint16Array&&(r.indexType="uint16")),super(t,r,d.defaultProps),this.usage=e.usage||0,this.indexType=r.indexType,this.updateTimestamp=t.incrementTimestamp()}readSyncWebGL(t,e){throw new Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(t,e,r){const n=ArrayBuffer.isView(t)?t.buffer:t,s=Math.min(t?t.byteLength:r,d.DEBUG_DATA_MAX_LENGTH);null===t?this.debugData=new ArrayBuffer(s):0===e&&r===t.byteLength?this.debugData=n.slice(0,s):this.debugData=n.slice(e,e+s)}}function p(t){const e=function(t){const e=g[t];return e}(m[t]),r=t.includes("norm"),n=!r&&!t.startsWith("float"),s=t.startsWith("s");return{dataType:m[t],byteLength:e,integer:n,signed:s,normalized:r}}const m={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},g={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4},y=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],b=/^(rg?b?a?)([0-9]*)([a-z]*)(-srgb)?(-webgl|-unsized)?$/;function w(t){const e=b.exec(t);if(e){const[,t,r,n,s,i]=e;if(t){const e=p(`${n}${r}`);return{format:t,components:t.length,srgb:"-srgb"===s,unsized:"-unsized"===i,webgl:"-webgl"===i,...e}}}return function(t){const e=v[t];if(!e)throw new Error(`Unknown format ${t}`);return{format:e.format||"",components:e.components||e.format?.length||1,byteLength:e.bpp||1,srgb:!1,unsized:!1}}(t)}const v={"rgba4unorm-webgl":{format:"rgba",bpp:2},"rgb565unorm-webgl":{format:"rgb",bpp:2},"rgb5a1unorm-webgl":{format:"rgba",bbp:2},rgb9e5ufloat:{format:"rgb",bbp:4},rg11b10ufloat:{format:"rgb",bbp:4},rgb10a2unorm:{format:"rgba",bbp:4},"rgb10a2uint-webgl":{format:"rgba",bbp:4},stencil8:{components:1,bpp:1,a:"stencil"},depth16unorm:{components:1,bpp:2,a:"depth"},depth24plus:{components:1,bpp:3,a:"depth"},depth32float:{components:1,bpp:4,a:"depth"},"depth24plus-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth24unorm-stencil8":{components:2,bpp:4,a:"depth-stencil"},"depth32float-stencil8":{components:2,bpp:4,a:"depth-stencil"}};class S{}class x{features;disabledFeatures;constructor(t=[],e){this.features=new Set(t),this.disabledFeatures=e||{}}*[Symbol.iterator](){yield*this.features}has(t){return!this.disabledFeatures[t]&&this.features.has(t)}}class A{static defaultProps={id:null,canvas:null,container:null,manageState:!0,width:800,height:600,requestMaxLimits:!0,debug:Boolean(n.get("debug")),spector:Boolean(n.get("spector")),break:[],initalizeFeatures:!0,disabledFeatures:{"compilation-status-async-webgl":!0},gl:null,onError:t=>n.error(t.message)};get[Symbol.toStringTag](){return"Device"}static VERSION=o;constructor(t){this.props={...A.defaultProps,...t},this.id=this.props.id||l(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=i;_lumaData={};isTextureFormatCompressed(t){return e=t,y.some((t=>e.startsWith(t)));var e}loseDevice(){return!1}getCanvasContext(){if(!this.canvasContext)throw new Error("Device has no CanvasContext");return this.canvasContext}createTexture(t){return(t instanceof Promise||"string"==typeof t)&&(t={data:t}),this._createTexture(t)}createCommandEncoder(t={}){throw new Error("not implemented")}readPixelsToArrayWebGL(t,e){throw new Error("not implemented")}readPixelsToBufferWebGL(t,e){throw new Error("not implemented")}setParametersWebGL(t){throw new Error("not implemented")}getParametersWebGL(t){throw new Error("not implemented")}withParametersWebGL(t,e){throw new Error("not implemented")}clearWebGL(t){throw new Error("not implemented")}resetWebGL(){throw new Error("not implemented")}timestamp=0;incrementTimestamp(){return this.timestamp++}onError(t){this.props.onError(t)}_getBufferProps(t){(t instanceof ArrayBuffer||ArrayBuffer.isView(t))&&(t={data:t});const e={...t};return(t.usage||0)&d.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?e.indexType="uint32":t.data instanceof Uint16Array?e.indexType="uint16":n.warn("indices buffer content must be of integer type")()),e}}function T(t,e){if(!t)throw new Error(e||"luma.gl: assertion failed.")}const P=new Map;class E{static defaultProps={...A.defaultProps,type:"best-available",devices:void 0};static stats=i;static log=n;static registerDevices(t){for(const e of t)T(e.type&&e.isSupported&&e.create),P.set(e.type,e)}static getAvailableDevices(){return Array.from(P).map((t=>t.type))}static getSupportedDevices(){return Array.from(P).filter((t=>t.isSupported())).map((t=>t.type))}static setDefaultDeviceProps(t){Object.assign(A.defaultProps,t)}static async attachDevice(t){const e=C(t.devices)||P;if(t.handle instanceof WebGL2RenderingContext){const r=e.get("webgl");if(r)return await r.attach(t.handle)}if(null===t.handle){const t=e.get("unknown");if(t)return await t.attach(null)}throw new Error("Failed to attach device. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}static async createDevice(t={}){(t={...A.defaultProps,...t}).gl&&(t.type="webgl");const e=C(t.devices)||P;switch(t.type){case"webgpu":let r=e.get("webgpu");if(r)return await r.create(t);break;case"webgl":let n=e.get("webgl");if(n)return await n.create(t);break;case"unknown":const s=e.get("unknown");if(s)return await s.create(t);break;case"best-available":if(r=e.get("webgpu"),r?.isSupported?.())return await r.create(t);if(n=e.get("webgl"),n?.isSupported?.())return await n.create(t)}throw new Error("No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.")}}function C(t){if(!t||0===t?.length)return null;const e=new Map;for(const r of t)e.set(r.type,r);return e}const $=t()&&"undefined"!=typeof document,M=()=>$&&"complete"===document.readyState,R={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,colorSpace:"srgb",alphaMode:"opaque"};class B{id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};static get isPageLoaded(){return M()}static pageLoaded=function(){if(M()||"undefined"==typeof window)return Promise.resolve();return new Promise((t=>{window.addEventListener("load",(()=>t()))}))}();constructor(e){if(this.props={...R,...e},e=this.props,!t())return this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,void(this.canvas=null);if(e.canvas)"string"==typeof e.canvas?this.canvas=function(t){const e=document.getElementById(t);if(!e&&!M())throw new Error(`Accessing '${t}' before page was loaded`);if(!(e instanceof HTMLCanvasElement))throw new Error("Object is not a canvas element");return e}(e.canvas):this.canvas=e.canvas;else{const t=function(t){const{width:e,height:r}=t,n=document.createElement("canvas");return n.id="lumagl-auto-created-canvas",n.width=e||1,n.height=r||1,n.style.width=Number.isFinite(e)?`${e}px`:"100%",n.style.height=Number.isFinite(r)?`${r}px`:"100%",n}(e),r=function(t){if("string"==typeof t){const e=document.getElementById(t);if(!e&&!M())throw new Error(`Accessing '${t}' before page was loaded`);if(!e)throw new Error(`${t} is not an HTML element`);return e}if(t)return t;return document.body}(e?.container||null);r.insertBefore(t,r.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver((t=>{for(const e of t)e.target===this.canvas&&this.update()})),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(t){if("undefined"!=typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas)return 1;if(!(t=void 0===t?this.props.useDevicePixels:t)||t<=0)return 1;if(!0===t){return"undefined"!=typeof window&&window.devicePixelRatio||1}return t}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":const t=this.getDevicePixelRatio(),e=this.canvas;return e.parentElement?[e.clientWidth*t,e.clientHeight*t]:[this.canvas.width,this.canvas.height];default:throw new Error(this.type)}}getAspect(){const[t,e]=this.getPixelSize();return t/e}cssToDeviceRatio(){try{const[t]=this.getDrawingBufferSize(),{clientWidth:e}=this._canvasSizeInfo;return e?t/e:1}catch{return 1}}cssToDevicePixels(t,e=!0){const r=this.cssToDeviceRatio(),[n,s]=this.getDrawingBufferSize();return function(t,e,r,n,s){const i=t,o=L(i[0],e,r);let a=D(i[1],e,n,s),c=L(i[0]+1,e,r);const u=c===r-1?c:c-1;let l;c=D(i[1]+1,e,n,s),s?(c=0===c?c:c+1,l=a,a=c):l=c===n-1?c:c-1;return{x:o,y:a,width:Math.max(u-o+1,1),height:Math.max(l-a+1,1)}}(t,r,n,s,e)}setDevicePixelRatio(t,e={}){if(!this.htmlCanvas)return;let r="width"in e?e.width:this.htmlCanvas.clientWidth,s="height"in e?e.height:this.htmlCanvas.clientHeight;r&&s||(n.log(1,"Canvas clientWidth/clientHeight is 0")(),t=1,r=this.htmlCanvas.width||1,s=this.htmlCanvas.height||1);const i=this._canvasSizeInfo;if(i.clientWidth!==r||i.clientHeight!==s||i.devicePixelRatio!==t){let e=t;const i=Math.floor(r*e),o=Math.floor(s*e);this.htmlCanvas.width=i,this.htmlCanvas.height=o;const[a,c]=this.getDrawingBufferSize();a===i&&c===o||(e=Math.min(a/r,c/s),this.htmlCanvas.width=Math.floor(r*e),this.htmlCanvas.height=Math.floor(s*e),n.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=s,this._canvasSizeInfo.devicePixelRatio=t}}getDrawingBufferSize(){const t=this.device.gl;if(!t)throw new Error("canvas size");return[t.drawingBufferWidth,t.drawingBufferHeight]}_setAutoCreatedCanvasId(t){"lumagl-auto-created-canvas"===this.htmlCanvas?.id&&(this.htmlCanvas.id=t)}}function L(t,e,r){return Math.min(Math.round(t*e),r-1)}function D(t,e,r,n){return n?Math.max(0,r-1-Math.round(t*e)):Math.min(Math.round(t*e),r-1)}class U extends h{static defaultProps={...h.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!0,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,type:void 0,sampler:{},view:void 0};static COPY_SRC=1;static COPY_DST=2;static TEXTURE_BINDING=4;static STORAGE_BINDING=8;static RENDER_ATTACHMENT=16;get[Symbol.toStringTag](){return"Texture"}dimension;format;width;height;depth;updateTimestamp;constructor(t,e,r=U.defaultProps){super(t,e,r),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,this.updateTimestamp=t.incrementTimestamp()}}class O extends h{static defaultProps={...h.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(t,e){super(t,e,O.defaultProps)}}class _ extends h{static defaultProps={...h.defaultProps,source:null,colorSpace:"srgb"};get[Symbol.toStringTag](){return"ExternalTexture"}constructor(t,e){super(t,e,_.defaultProps)}}function I(t,e,r){let n="";const s=e.split(/\r?\n/),i=t.slice().sort(((t,e)=>t.lineNum-e.lineNum));switch(r?.showSourceCode||"no"){case"all":let e=0;for(let t=1;t<=s.length;t++)for(n+=z(s[t-1],t,r);i.length>e&&i[e].lineNum===t;){const t=i[e++];n+=N(t,s,t.lineNum,{...r,inlineSource:!1})}return n;case"issues":case"no":for(const e of t)n+=N(e,s,e.lineNum,{inlineSource:"no"!==r?.showSourceCode});return n}}function N(t,e,r,n){if(n?.inlineSource){const n=function(t,e,r){let n="";for(let s=e-2;s<=e;s++){const i=t[s-1];void 0!==i&&(n+=z(i,e,r))}return n}(e,r);return`\n${n}${t.linePos>0?`${" ".repeat(t.linePos+5)}^^^\n`:""}${t.type.toUpperCase()}: ${t.message}\n\n`}return n?.html?`<div class='luma-compiler-log-error' style="color:red;"><b> ${t.type.toUpperCase()}: ${t.message}</b></div>`:`${t.type.toUpperCase()}: ${t.message}`}function z(t,e,r){const n=r?.html?t.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):t;return`${function(t,e){let r="";for(let n=t.length;n<e;++n)r+=" ";return r+t}(String(e),4)}: ${n}${r?.html?"<br/>":"\n"}`}function F(t,e){return{name:W(t,e),language:"glsl",version:k(t)}}function W(t,e="unnamed"){const r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(t);return r?r[1]:e}function k(t){let e=100;const r=t.match(/[^\s]+/g);if(r&&r.length>=2&&"#version"===r[0]){const t=parseInt(r[1],10);Number.isFinite(t)&&(e=t)}return e}class V extends h{static defaultProps={...h.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debug:"errors"};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(t,e){super(t,{id:G(e),...e},V.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(t=this.props.debug){switch(t){case"never":return;case"errors":if("success"===this.compilationStatus)return}const e=await this.getCompilationInfo();"warnings"===this.props.debug&&0===e?.length||this._displayShaderLog(e)}_displayShaderLog(t){if("undefined"==typeof document||!document?.createElement)return;const e=F(this.source).name,r=`${this.stage} ${e}`;let n=I(t,this.source,{showSourceCode:"all",html:!0});const s=this.getTranslatedSource();s&&(n+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);const i=document.createElement("Button");i.innerHTML=`\n<h1>Shader Compilation Error in ${r}</h1><br /><br />\n<code style="user-select:text;"><pre>\n${n}\n</pre></code>`,i.style.top="10px",i.style.left="10px",i.style.position="absolute",i.style.zIndex="9999",i.style.width="100%",i.style.textAlign="left",document.body.appendChild(i);const o=document.getElementsByClassName("luma-compiler-log-error");o[0]?.scrollIntoView&&o[0].scrollIntoView(),i.onclick=()=>{const t=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(t)}}}function G(t){return F(t.source).name||t.id||l(`unnamed ${t.stage}-shader`)}class j extends h{static defaultProps={...h.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"nearest",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(t,e){super(t,e,j.defaultProps)}}class H extends h{static defaultProps={...h.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;colorAttachments=[];depthStencilAttachment=null;constructor(t,e={}){super(t,e,H.defaultProps),this.width=this.props.width,this.height=this.props.height}resize(t){let e=!t;if(t){const[r,n]=Array.isArray(t)?t:[t.width,t.height];e=e||n!==this.height||r!==this.width,this.width=r,this.height=n}e&&(n.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw new Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((t=>{if("string"==typeof t){const e=this.createColorTexture(t);return this.attachResource(e),e.view}return t instanceof U?t.view:t}));const t=this.props.depthStencilAttachment;if(t)if("string"==typeof t){const e=this.createDepthStencilTexture(t);this.attachResource(e),this.depthStencilAttachment=e.view}else this.depthStencilAttachment=t instanceof U?t.view:t}createColorTexture(t){return this.device.createTexture({id:"color-attachment",usage:U.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}createDepthStencilTexture(t){return this.device.createTexture({id:"depth-stencil-attachment",usage:U.RENDER_ATTACHMENT,format:t,width:this.width,height:this.height})}resizeAttachments(t,e){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){const n=this.device._createTexture({...this.colorAttachments[r].props,width:t,height:e});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=n.view,this.attachResource(n.view)}if(this.depthStencilAttachment){const r=this.device._createTexture({...this.depthStencilAttachment.props,width:t,height:e});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}}}class Y extends h{static defaultProps={...h.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},vertexCount:0,instanceCount:0,bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(t,e){super(t,e,Y.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(t){throw new Error("Use uniform blocks")}}class X extends h{static defaultProps={...h.defaultProps,framebuffer:null,parameters:void 0,clearColor:[0,0,0,0],clearDepth:1,clearStencil:0,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(t,e){super(t,e,X.defaultProps)}}class q extends h{static defaultProps={...h.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";constructor(t,e){super(t,e,q.defaultProps)}}class Q extends h{static defaultProps={...h.defaultProps,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"ComputePass"}constructor(t,e){super(t,e,Q.defaultProps)}}class Z extends h{static defaultProps={...h.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(t,e){super(t,e,Z.defaultProps)}}class J extends h{static defaultProps={...h.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(t,e){super(t,e,J.defaultProps)}}function K(t){const[e,r]=tt[t],n="i32"===e||"u32"===e,s="u32"!==e,i=et[e]*r,o=function(t,e){let r;switch(t){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return e<=2?"float16x2":"float16x4"}if(1===e)return r;return`${r}x${e}`}(e,r);return{dataType:e,components:r,defaultVertexFormat:o,byteLength:i,integer:n,signed:s}}const tt={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},et={f32:4,f16:2,i32:4,u32:4};function rt(t){let e;t.endsWith("-webgl")&&(t.replace("-webgl",""),e=!0);const[r,n]=t.split("x"),s=r,i=n?parseInt(n):1,o=p(s),a={type:s,components:i,byteLength:o.byteLength*i,integer:o.integer,signed:o.signed,normalized:o.normalized};return e&&(a.webglOnly=!0),a}function nt(t,e){const r={};for(const n of t.attributes)r[n.name]=st(t,e,n.name);return r}function st(t,e,r){const s=function(t,e){const r=t.attributes.find((t=>t.name===e));r||n.warn(`shader layout attribute "${e}" not present in shader`);return r||null}(t,r),i=function(t,e){it(t);let r=function(t,e){for(const r of t)if(r.format&&r.name===e)return{attributeName:r.name,bufferName:e,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}(t,e);if(r)return r;if(r=function(t,e){for(const r of t){let t=r.byteStride;if("number"!=typeof r.byteStride)for(const e of r.attributes||[]){t+=rt(e.format).byteLength}const n=r.attributes?.find((t=>t.attribute===e));if(n)return{attributeName:n.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:n.format,byteOffset:n.byteOffset,byteStride:t}}return null}(t,e),r)return r;return n.warn(`layout for attribute "${e}" not present in buffer layout`),null}(e,r);if(!s)return null;const o=K(s.type),a=i?.vertexFormat||o.defaultVertexFormat,c=rt(a);return{attributeName:i?.attributeName||s.name,bufferName:i?.bufferName||s.name,location:s.location,shaderType:s.type,shaderDataType:o.dataType,shaderComponents:o.components,vertexFormat:a,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:o.integer,stepMode:i?.stepMode||s.stepMode,byteOffset:i?.byteOffset||0,byteStride:i?.byteStride||0}}function it(t){for(const e of t)(e.attributes&&e.format||!e.attributes&&!e.format)&&n.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}function ot(t,e){const r={...t,attributes:t.attributes.map((t=>({...t})))};for(const t of e?.attributes||[]){const e=r.attributes.find((e=>e.name===t.name));e?(e.type=t.type||e.type,e.stepMode=t.stepMode||e.stepMode):n.warn(`shader layout attribute ${t.name} not present in shader`)}return r}class at extends h{static defaultProps={...h.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(t,e){super(t,e,at.defaultProps),this.maxVertexAttributes=t.limits.maxVertexAttributes,this.attributes=new Array(this.maxVertexAttributes).fill(null),this.attributeInfos=function(t,e,r=16){const n=nt(t,e),s=new Array(r).fill(null);for(const t of Object.values(n))s[t.location]=t;return s}(e.renderPipeline.shaderLayout,e.renderPipeline.bufferLayout,this.maxVertexAttributes)}setConstantWebGL(t,e){throw new Error("constant attributes not supported")}}class ct extends h{static defaultProps={...h.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(t,e){super(t,e,ct.defaultProps)}}class ut extends h{static defaultProps={...h.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(t,e){super(t,e,ut.defaultProps)}}const lt={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};function ft(t){const e=lt[t];return T(t),e}function ht(t,e){switch(e){case 1:return t;case 2:return t+t%2;default:return t+(4-t%4)%4}}let dt;function pt(t){return(!dt||dt.byteLength<t)&&(dt=new ArrayBuffer(t)),dt}function mt(t,e){return new t(pt(t.BYTES_PER_ELEMENT*e),0,e)}function gt(t){const{target:e,source:r,start:n=0,count:s=1}=t,i=r.length,o=s*i;let a=0;for(let t=n;a<i;a++)e[t++]=r[a];for(;a<o;)a<o-a?(e.copyWithin(n+a,n,n+a),a*=2):(e.copyWithin(n+a,n,n+o-a),a=o);return t.target}class yt{layout={};byteLength;constructor(t){let e=0;for(const[r,n]of Object.entries(t)){const t=ft(n),{type:s,components:i}=t;e=ht(e,i);const o=e;e+=i,this.layout[r]={type:s,size:i,offset:o}}e+=(4-e%4)%4;const r=4*e;this.byteLength=Math.max(r,1024)}getData(t){const e=pt(Math.max(this.byteLength,1024)),r={i32:new Int32Array(e),u32:new Uint32Array(e),f32:new Float32Array(e),f16:new Uint16Array(e)};for(const[e,s]of Object.entries(t)){const t=this.layout[e];if(!t){n.warn(`Supplied uniform value ${e} not present in uniform block layout`)();continue}const{type:i,size:o,offset:a}=t,u=r[i];if(1===o){if("number"!=typeof s&&"boolean"!=typeof s){n.warn(`Supplied value for single component uniform ${e} is not a number: ${s}`)();continue}u[a]=Number(s)}else{const t=c(s);if(!t){n.warn(`Supplied value for multi component / array uniform ${e} is not a numeric array: ${s}`)();continue}u.set(t,a)}}return new Uint8Array(e)}has(t){return Boolean(this.layout[t])}get(t){return this.layout[t]}}class bt{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(t){if(this.name=t?.name,t?.name&&t?.shaderLayout){const e=t?.shaderLayout.bindings?.find((e=>"uniform"===e.type&&e.name===t?.name));if(!e)throw new Error(t?.name);const r=e;for(const t of r.uniforms||[])this.bindingLayout[t.name]=t}}setUniforms(t){for(const[e,r]of Object.entries(t))this._setUniform(e,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${e}=${r}`)}setNeedsRedraw(t){this.needsRedraw=this.needsRedraw||t}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(t,e){(function(t,e,r=16){if(t!==e)return!1;const n=c(t);if(!n)return!1;const s=c(e);if(s&&n.length===s.length)for(let t=0;t<n.length;++t)if(s[t]!==n[t])return!1;return!0})(this.uniforms[t],e)||(this.uniforms[t]=function(t){const e=c(t);return e?e.slice():t}(e),this.modifiedUniforms[t]=!0,this.modified=!0)}}class wt{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(t){for(const[e,r]of Object.entries(t)){const t=e,n=new yt(r.uniformTypes||{});this.uniformBufferLayouts.set(t,n);const s=new bt({name:e});s.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(t,s)}}destroy(){for(const t of this.uniformBuffers.values())t.destroy()}setUniforms(t){for(const[e,r]of Object.entries(t))this.uniformBlocks.get(e).setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(t){return this.uniformBufferLayouts.get(t).byteLength}getUniformBufferData(t){const e=this.uniformBlocks.get(t).getAllUniforms();return this.uniformBufferLayouts.get(t).getData(e)}createUniformBuffer(t,e,r){r&&this.setUniforms(r);const n=this.getUniformBufferByteLength(e),s=t.createBuffer({usage:d.UNIFORM|d.COPY_DST,byteLength:n}),i=this.getUniformBufferData(e);return s.write(i),s}getManagedUniformBuffer(t,e){if(!this.uniformBuffers.get(e)){const r=this.getUniformBufferByteLength(e),n=t.createBuffer({usage:d.UNIFORM|d.COPY_DST,byteLength:r});this.uniformBuffers.set(e,n)}return this.uniformBuffers.get(e)}updateUniformBuffers(){let t=!1;for(const e of this.uniformBlocks.keys()){const r=this.updateUniformBuffer(e);t||=r}return t&&n.log(3,`UniformStore.updateUniformBuffers(): ${t}`)(),t}updateUniformBuffer(t){const e=this.uniformBlocks.get(t);let r=!1;if(this.uniformBuffers.get(t)&&e.needsRedraw){r||=e.needsRedraw;const s=this.getUniformBufferData(t);this.uniformBuffers.get(t).write(s);const i=this.uniformBlocks.get(t).getAllUniforms();n.log(4,`Writing to uniform buffer ${String(t)}`,s,i)()}return r}}function vt(t){const e=ArrayBuffer.isView(t)?t.constructor:t;switch(e){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw new Error(e.constructor.name)}}function St(t){switch(t){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw new Error(t)}}function xt(t,e,r){if(!e||e>4)throw new Error(`size ${e}`);const n=e;let s=vt(t);if("uint8"===s||"sint8"===s){if(1===n||3===n)throw new Error(`size: ${e}`);return r&&(s=s.replace("int","norm")),`${s}x${n}`}if("uint16"===s||"sint16"===s){if(1===n||3===n)throw new Error(`size: ${e}`);return r&&(s=s.replace("int","norm")),`${s}x${n}`}return 1===n?s:`${s}x${n}`}function At(t){return t}function Tt(t){return null!==c(t)||"number"==typeof t||"boolean"==typeof t}function Pt(t){const e={bindings:{},uniforms:{}};return Object.keys(t).forEach((r=>{const n=t[r];Tt(n)?e.uniforms[r]=n:e.bindings[r]=n})),e}function Et(t,e={}){const{isInteger:r=!1}=e;if(Array.isArray(t)||ArrayBuffer.isView(t))return function(t,e={}){const{maxElts:r=16,size:n=1}=e;let s="[";for(let i=0;i<t.length&&i<r;++i)i>0&&(s+=","+(i%n==0?" ":"")),s+=Et(t[i],e);return`${s}${t.length>r?"...":"]"}`}(t,e);if("number"!=typeof t)return String(t);if(Math.abs(t)<1e-16)return r?"0":"0.";if(r)return t.toFixed(0);if(Math.abs(t)>100&&Math.abs(t)<1e4)return t.toFixed(0);const n=t.toPrecision(2);return n.indexOf(".0")===n.length-2?n.slice(0,-1):n}function Ct(t,e,r,s){const i=`See luma.gl ${r} Upgrade Guide at https://luma.gl/docs/upgrade-guide`,o=Object.getPrototypeOf(t);s.forEach((t=>{o.methodName||(o[t]=()=>{throw n.removed(`Calling removed method ${e}.${t}: `,i)(),new Error(t)})}))}function $t(t,e,r){const{removedProps:s={},deprecatedProps:i={},replacedProps:o={}}=r;for(const r in s)if(r in e){const e=s[r]?`${t}.${s[r]}`:"N/A";n.removed(`${t}.${r}`,e)()}for(const r in i)if(r in e){const e=i[r];n.deprecated(`${t}.${r}`,`${t}.${e}`)()}let a=null;for(const[r,s]of Object.entries(o))r in e&&(n.deprecated(`${t}.${r}`,`${t}.${s}`)(),a=a||Object.assign({},e),a[s]=e[r],delete a[r]);return a||e}let Mt="";function Rt(t){Mt=t}async function Bt(t,e){t=t.startsWith("http")?t:Mt+t;const r=e?.dataType||"text",n=await fetch(t,e);return await n[r]()}async function Lt(t,e){const r=new Image;return r.crossOrigin=e?.crossOrigin||"anonymous",r.src=t.startsWith("http")?t:Mt+t,await r.decode(),await createImageBitmap(r)}async function Dt(t,e){return await new Promise(((r,n)=>{try{const s=new Image;s.onload=()=>r(s),s.onerror=()=>n(new Error(`Could not load image ${t}.`)),s.crossOrigin=e?.crossOrigin||"anonymous",s.src=t.startsWith("http")?t:Mt+t}catch(t){n(t)}}))}async function Ut(t,e){const r=document.getElementsByTagName("head")[0];if(!r)throw new Error("loadScript");const n=document.createElement("script");return n.setAttribute("type","text/javascript"),n.setAttribute("src",t),e&&(n.id=e),new Promise(((e,s)=>{n.onload=e,n.onerror=e=>s(new Error(`Unable to load script '${t}': ${e}`)),r.appendChild(n)}))}function Ot(){let t=1,e=1;return()=>{return t=Math.sin(17.23*e),e=Math.cos(27.92*t),(r=1432.71*Math.abs(t*e))-Math.floor(r);var r}}const _t=Ot();function It(t,e,r){if(t===e)return!0;if(!r||!t||!e)return!1;if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!It(t[n],e[n],r-1))return!1;return!0}if(Array.isArray(e))return!1;if("object"==typeof t&&"object"==typeof e){const n=Object.keys(t),s=Object.keys(e);if(n.length!==s.length)return!1;for(const s of n){if(!e.hasOwnProperty(s))return!1;if(!It(t[s],e[s],r-1))return!1}return!0}return!1}function Nt(t){return"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(t):setTimeout(t,1e3/60)}function zt(t){return"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(t):clearTimeout(t)}const Ft=t=>`${t}`;export{d as Buffer,B as CanvasContext,J as CommandBuffer,Z as CommandEncoder,Q as ComputePass,q as ComputePipeline,A as Device,x as DeviceFeatures,S as DeviceLimits,_ as ExternalTexture,H as Framebuffer,ut as QuerySet,X as RenderPass,Y as RenderPipeline,h as Resource,j as Sampler,V as Shader,s as StatsManager,U as Texture,O as TextureView,ct as TransformFeedback,bt as UniformBlock,yt as UniformBufferLayout,wt as UniformStore,o as VERSION,at as VertexArray,T as assert,zt as cancelAnimationFrame,At as cast,$t as checkProps,K as decodeShaderAttributeType,ft as decodeShaderUniformType,w as decodeTextureFormat,rt as decodeVertexFormat,It as deepEqual,gt as fillArray,I as formatCompilerLog,Et as formatValue,nt as getAttributeInfosFromLayouts,vt as getDataTypeFromTypedArray,mt as getScratchArray,pt as getScratchArrayBuffer,St as getTypedArrayFromDataType,xt as getVertexFormatFromAttribute,Ft as glsl,c as isNumberArray,f as isObjectEmpty,a as isTypedArray,Tt as isUniformValue,Bt as loadFile,Dt as loadImage,Lt as loadImageBitmap,Ut as loadScript,n as log,E as luma,Ot as makeRandomNumberGenerator,ot as mergeShaderLayout,_t as random,Nt as requestAnimationFrame,Rt as setPathPrefix,Pt as splitUniformsAndBindings,Ct as stubRemovedMethods,l as uid};export default null;
