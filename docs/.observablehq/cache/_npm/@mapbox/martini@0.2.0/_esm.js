/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.19.2.
 * Original file: /npm/@mapbox/martini@0.2.0/index.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
class t{constructor(t=257){this.gridSize=t;const r=t-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let t=0;t<this.numTriangles;t++){let i=t+2,s=0,n=0,e=0,o=0,a=0,h=0;for(1&i?e=o=a=r:s=n=h=r;(i>>=1)>1;){const t=s+e>>1,r=n+o>>1;1&i?(e=s,o=n,s=a,n=h):(s=e,n=o,e=a,o=h),a=t,h=r}const c=4*t;this.coords[c+0]=s,this.coords[c+1]=n,this.coords[c+2]=e,this.coords[c+3]=o}}createTile(t){return new r(t,this)}}class r{constructor(t,r){const i=r.gridSize;if(t.length!==i*i)throw new Error(`Expected terrain data of length ${i*i} (${i} x ${i}), got ${t.length}.`);this.terrain=t,this.martini=r,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:r,coords:i,gridSize:s}=this.martini,{terrain:n,errors:e}=this;for(let o=t-1;o>=0;o--){const t=4*o,a=i[t+0],h=i[t+1],c=i[t+2],l=i[t+3],g=a+c>>1,d=h+l>>1,u=g+d-h,f=d+a-g,m=(n[h*s+a]+n[l*s+c])/2,w=d*s+g,M=Math.abs(m-n[w]);if(e[w]=Math.max(e[w],M),o<r){const t=(h+f>>1)*s+(a+u>>1),r=(l+f>>1)*s+(c+u>>1);e[w]=Math.max(e[w],e[t],e[r])}}}getMesh(t=0){const{gridSize:r,indices:i}=this.martini,{errors:s}=this;let n=0,e=0;const o=r-1;function a(o,h,c,l,g,d){const u=o+c>>1,f=h+l>>1;Math.abs(o-g)+Math.abs(h-d)>1&&s[f*r+u]>t?(a(g,d,o,h,u,f),a(c,l,g,d,u,f)):(i[h*r+o]=i[h*r+o]||++n,i[l*r+c]=i[l*r+c]||++n,i[d*r+g]=i[d*r+g]||++n,e++)}i.fill(0),a(0,0,o,o,o,0),a(o,o,0,0,0,o);const h=new Uint16Array(2*n),c=new Uint32Array(3*e);let l=0;function g(n,e,o,a,d,u){const f=n+o>>1,m=e+a>>1;if(Math.abs(n-d)+Math.abs(e-u)>1&&s[m*r+f]>t)g(d,u,n,e,f,m),g(o,a,d,u,f,m);else{const t=i[e*r+n]-1,s=i[a*r+o]-1,g=i[u*r+d]-1;h[2*t]=n,h[2*t+1]=e,h[2*s]=o,h[2*s+1]=a,h[2*g]=d,h[2*g+1]=u,c[l++]=t,c[l++]=s,c[l++]=g}}return g(0,0,o,o,o,0),g(o,o,0,0,0,o),{vertices:h,triangles:c}}}export{t as default};
